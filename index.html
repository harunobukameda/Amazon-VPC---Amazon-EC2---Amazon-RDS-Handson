
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title></title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id=""
                  title=""
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="はじめに" duration="0">
        <p class="image-container"><img style="width: 750.00px" src="img\\f755787aade4c158"></p>
<p>Amazon Web Services (AWS) を利用して、セキュアでスケーラブルなウェブサービスの構築手順を体験できるハンズオンを実施いたします。</p>
<p>AWS を使ってより安全にサービスを運用する方法、ウェブサービスの規模に合わせて、柔軟にシステムを拡張する方法を体験できる内容です。</p>
<aside class="special"><p><strong>本ハンズオンのドキュメントで掲載されているスクリーンショット (画面キャプチャ) は 2022年04月時点のもので、現在の画面とは異なる場合がございます。予めご了承ください。</strong></p>
</aside>
<h2 is-upgraded><strong>準備事項</strong></h2>
<p>インターネットに接続可能な PC</p>
<p class="image-container"><img style="width: 750.00px" src="img\\73c30bd98efd4cca"></p>
<p>AWS を利用するにはインターネット接続が必要です。Windows、mac、Linux をご準備ください。本ハンズオン資料は mac にて作成しています。</p>
<p>AWS アカウント</p>
<p class="image-container"><img style="width: 750.00px" src="img\\1247d411e78073e8"></p>
<p>AWS アカウントを事前にご準備ください。</p>
<p>ブラウザ</p>
<p class="image-container"><img style="width: 750.00px" src="img\\32d9ad7bb8d38a03"></p>
<p>Firefox もしくは Google Chrome を推奨します。本ハンズオン資料は Google Chrome にて検証しています。</p>
      </google-codelab-step>
    
      <google-codelab-step label="座学 - リージョンとアベイラビリティゾーン (AZ)" duration="0">
        <p><strong>AWS のセキュリティやスケーラビリティを 高める機能・サービス 1/6</strong></p>
<h3 is-upgraded><strong>リージョン</strong></h3>
<p>AWS クラウドは、2022年4月現在、全世界 26 の地域にある 84 のアベイラビリティーゾーンにまたがっており、24 アベイラビリティーゾーンと 8 AWS リージョンを追加する計画が発表されています。</p>
<p>AWS のリージョンは必ず複数のデータセンタークラスタ（=AZ）で構成されています。 各 AZ 間は数十キロ離れ、電源やネットワークが独立しており、高い耐障害性を提供できる設計になっています。</p>
<p><a href="https://aws.amazon.com/jp/about-aws/global-infrastructure/" target="_blank">AWS グローバルインフラストラクチャマップ</a></p>
<p class="image-container"><img style="width: 750.00px" src="img\\f90e3d1e5d66e853.gif"></p>


      </google-codelab-step>
    
      <google-codelab-step label="座学 - Amazon VPC (Virtual Private Cloud)" duration="0">
        <p><strong>AWS のセキュリティやスケーラビリティを 高める機能・サービス 2/6</strong></p>
<p class="image-container"><img style="width: 750.00px" src="img\\3f8e3fe9fee54229"></p>
<p>VPC はプライベートな仮想ネットワークサービスです。VPC を使うと AWS クラウド内にお客様専用のプライベートアドレスの空間を構築できます。</p>
<p>社内ネットワークとインターネット VPN やキャリアの閉域網で接続ができます。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\31b9625da159b3be"></p>
<h2 is-upgraded><strong>VPCとサブネットについて</strong></h2>
<p>1 つの VPC は、1 つのネットワークアドレスを CIDR (Classless Inter-Domain Routing) で定義します。</p>
<p>1 つの VPC 内には、複数のサブネットを作成することができます。</p>
<p>サブネットは特定のアベイラビリティーゾーン内に配置します。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\6f5ddf2c15f13059"></p>
<table>
<tr><td colspan="1" rowspan="1"><p>CIDR</p>
</td><td colspan="1" rowspan="1"><p>IP アドレス数</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>xxx.xxx.xxx.xxx/16</p>
</td><td colspan="1" rowspan="1"><p>65,531</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>xxx.xxx.xxx.xxx/20</p>
</td><td colspan="1" rowspan="1"><p>4,091</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>xxx.xxx.xxx.xxx/24</p>
</td><td colspan="1" rowspan="1"><p>251</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>xxx.xxx.xxx.xxx/28</p>
</td><td colspan="1" rowspan="1"><p>11</p>
</td></tr>
</table>
<p>上記は払い出される IP アドレス数から、AWS の予約 IP 数を抜いた「ユーザーが利用できる IP 数」です。</p>
<p>各サブネットにおいて先頭の 4 IP アドレスと最後の 1 IP アドレスは AWS 側で確保されます。</p>
<ul>
<li>AWS &gt; ドキュメント &gt; Amazon VPC &gt; ユーザーガイド &gt; VPC とサブネットの概要 - <a href="https://docs.aws.amazon.com/ja_jp/vpc/latest/userguide/VPC_Subnets.html#VPC_Sizing" target="_blank">IPv4 用の VPC とサブネットのサイズ設定</a></li>
</ul>
      </google-codelab-step>
    
      <google-codelab-step label="座学 - ルートテーブル" duration="0">
        <p><strong>AWS のセキュリティやスケーラビリティを 高める機能・サービス 3/6</strong></p>
<p class="image-container"><img style="width: 750.00px" src="img\\469adc1f652df34b"></p>
<p>各サブネットにはルートテーブルがアタッチされます。</p>
<p>ルートテーブルの設定を変更することでデータの流れを制御できます。</p>
<h2 is-upgraded><strong>パブリックサブネット</strong></h2>
<p>ルートテーブル: rtb-XXXXXXXX</p>
<table>
<tr><td colspan="1" rowspan="1"><p>送信先</p>
</td><td colspan="1" rowspan="1"><p>ターゲット</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>10.0.0.0/16</p>
</td><td colspan="1" rowspan="1"><p>local</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>0.0.0.0/0</p>
</td><td colspan="1" rowspan="1"><p>igw-XXXXXXXX</p>
</td></tr>
</table>
<aside class="special"><p><strong>ルーティングテーブルに IGW (インターネット ゲートウェイ) へのルーティングを設定すると、外部とのアクセスが可能になります。これを &#34;パブリックサブネット&#34; といいます、IGW のルーティングがないものは &#34;プライベートサブネット&#34; といいます。</strong></p>
</aside>
<h2 is-upgraded><strong>プライベートサブネット</strong></h2>
<p>ルートテーブル: rtb-XXXXXXXX</p>
<table>
<tr><td colspan="1" rowspan="1"><p>送信先</p>
</td><td colspan="1" rowspan="1"><p>ターゲット</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>10.0.0.0/16</p>
</td><td colspan="1" rowspan="1"><p>local</p>
</td></tr>
</table>
<p class="image-container"><img alt="ルートテーブルのイメージ画像" style="width: 750.00px" src="img\\eb1de3cde87262e9"></p>


      </google-codelab-step>
    
      <google-codelab-step label="座学 - セキュリティグループ" duration="0">
        <p><strong>AWS のセキュリティやスケーラビリティを 高める機能・サービス 4/6</strong></p>
        <p><img alt="Firewall イメージアイコン" style="width: 750.00px" src="img\\e251e418ca5598ae"></p>
        <p>インターネットからのトラフィック (インバウンド) をブロックするだけでなく、EC2 からのトラフィック (アウトバウンド) も制限できるファイアウォール機能です。 </p>
        <p><img alt="セキュリティグループイメージ画像" style="width: 750.00px" src="img\\f052e2651edb7e5d"></p>
        <p>個々のインスタンスごとに、インバウンド、アウトバウンドに対して下記の許可ルールを定義できます。ルールは <strong>ステートフル</strong> で扱われ、明示ルールが無い通信は拒否されます。</p>
<h3 is-upgraded><strong>インバウンド</strong></h3>
<ul>
<li>プロトコル (TCP/UDP/ICMP)</li>
<li>ポート範囲 (ポート番号の範囲)</li>
<li>送信元 (アクセス元の IP アドレス)</li>
</ul>
<h3 is-upgraded><strong>アウトバウンド</strong></h3>
<ul>
<li>プロトコル (TCP/UDP/ICMP)</li>
<li>ポート範囲 (ポート番号の範囲)</li>
<li>送信先 (アクセス先の IP アドレス)</li>
</ul>
      </google-codelab-step>
    
      <google-codelab-step label="座学 - NACL (Network Access Control List)" duration="0">
        <p><strong>AWS のセキュリティやスケーラビリティを 高める機能・サービス 5/6</strong></p>
<p class="image-container"><img style="width: 750.00px" src="img\\68e755e2cc788061"></p>
<aside class="special"><p><strong>本日のハンズオンでは、NACL は使いません。</strong></p>
</aside>
<p>制御可能な項目はセキュリティグループと同じです。</p>
<p>セキュリティグループは、ステートフルで動作し、NACL はステートレスで動作します。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\749299291fb020f3"></p>
<h2 is-upgraded><strong>Network Access Control List</strong></h2>
<ul>
<li>個々のサブネットごとにアクセス制御が可能</li>
<li>インバウンド、アウトバウンドに対して下記の設定が可能</li>
</ul>
<h2 is-upgraded>インバウンド</h2>
<ul>
<li>ポート範囲 (ポート番号の範囲)</li>
<li>送信元 (アクセス元の IP アドレス)</li>
<li>Allow（許可）/ Deny（否定）</li>
</ul>
<h2 is-upgraded>アウトバウンド</h2>
<ul>
<li>ポート範囲 (ポート番号の範囲)</li>
<li>送信先 (アクセス先の IP アドレス)</li>
<li>Allow（許可）/ Deny（否定）</li>
</ul>
      </google-codelab-step>
    
      <google-codelab-step label="座学 - AWS IAM" duration="0">
        <p><strong>AWS のセキュリティやスケーラビリティを 高める機能・サービス 6/6</strong></p>
<p class="image-container"><img alt="IAM のアイコン" style="width: 750.00px" src="img\\52a5b64cfe33128c"></p>
<p>AWS 自体のリソース操作をよりセキュアに扱うための認証・認可の仕組みです。</p>
<p>AWS 利用者の認証とアクセスポリシーを「ユーザーグループ」「ユーザー」「ロール」で管理します。</p>
<ul>
<li>実行出来る操作を IAM ポリシーで設定</li>
<li>ユーザーごとに認証情報の設定が可能</li>
<li>AWS マネージメントコンソールにはユーザ名とパスワードを使用 さらに、MFA (多要素認証) の利用が推奨</li>
<li>API にはアクセスキーとシークレットキーを使用</li>
</ul>
<h2 is-upgraded>IAM ポリシーで必要最小限のみ付与</h2>
<p class="image-container"><img style="width: 750.00px" src="img\\f5c72394d3a82364"></p>


      </google-codelab-step>
    
      <google-codelab-step label="座学 - MFA (多要素認証) で認証の安全性を高める" duration="0">
        <p><strong>AWS のセキュリティやスケーラビリティを 高める機能・サービス - 備考</strong></p>
<h2 is-upgraded><strong>AWS アカウント (ルートアカウント) の保護</strong></h2>
<p>AWS アカウント (ルートアカウント) は、ハードウェアトークンで保護することが推奨されています。</p>
<p>また、ハードウェアトークンは金庫などで管理することが推奨されています。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\38b70880a98eea81"></p>
<h2 is-upgraded><strong>IAM アカウントの保護</strong></h2>
<p>IAM アカウントは、個人で利用するアカウントです。</p>
<p>こちらは、仮想 MFA 対応のスマホアプリにて保護すると効率的にご利用いただけます。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\e2879f65f79222d6"></p>
<p>MFA (多要素認証) を設定すると、AWS アカウントサインイン時に <strong>6 桁</strong> のコードを求められるようになります。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\f8cb6c8d4702dd25"></p>


      </google-codelab-step>
    
      <google-codelab-step label="ハンズオン" duration="0">
        <h2 is-upgraded><strong>ハンズオンの流れ</strong></h2>
<h3 is-upgraded><strong>フェーズ 1</strong></h3>
<p>WordPress サイトを最小構成でスタートします。</p>
<ul>
<li>サーバー 1 台構成</li>
</ul>
<p>パブリックサブネットに <strong>Amazon EC2</strong> インスタンス (サーバー) を起動します。</p>
<p>サーバーには SSH ではなく、<strong>AWS Systems Manager</strong> の セッションマネージャー 経由でセキュアに接続します。</p>
<p>WordPress をホスティングして、ユーザーがブラウザ経由で Web サイトを閲覧できるようにします。</p>
<p>フェーズ 1 は、サーバー 1 台構成のため、スケールするには<strong> インスタンスファミリー</strong> を変更してサイズアップする必要があります。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\549ae683c1afbf6e"></p>
<h3 is-upgraded><strong>フェーズ 2</strong></h3>
<p>スケールできるアーキテクチャに移行する準備をします。</p>
<h3 is-upgraded><strong>Web + DB (サーバー 2 台構成)</strong></h3>
<p><strong>Amazon Aurora MySQL</strong> インスタンスを起動して、データベースにします。</p>
<p>サーバーにて稼働させていたデータベースを停止して、Aurora データベースに切り替えます。 フェーズ 2 の状態はまだスケールするための準備で、スケールはインスタンスファミリーを変更してサイズアップする必要があります。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\807c2e96aa8f02fd"></p>
<h3 is-upgraded><strong>フェーズ 3</strong></h3>
<p>Web サーバーがスケールできる構成にします。</p>
<ul>
<li>ALB + Web x 2 + DB (サーバー 3 台構成)</li>
</ul>
<p>Web サーバーを複製できるように <strong>Amazon Machine Images (AMI)</strong> を取得します。</p>
<p>AMI から Web サーバーを複製して 2 台構成にします。</p>
<p>2 台のサーバーに Web リクエストがバランシングされるように、前段に <strong>Application Load Balancer </strong>を起動します。</p>
<p>フェーズ 3 になると、Web リクエストが増えた際に 1 台のサーバーをスペックアップする方法 (スケールアップ) に加えて、台数を増やす (スケールアウト) ができるようになります。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\d11cfd66c223453a"></p>
<h3 is-upgraded><strong>オプション</strong></h3>
<p>DB サーバーを冗長化された構成にします。</p>
<ul>
<li>ALB + Web x 2 + DB x 2 (サーバー 4 台構成)</li>
</ul>
<p>データベースに障害が発生した際に、フェイルオーバーするようにスタンバイインスタンスを起動して、Multi-AZ 構成にします。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\7e23aa04f26177be"></p>
<h3 is-upgraded>最終構成図</h3>
<p class="image-container"><img style="width: 750.00px" src="img\\5d2572298003dfa2"></p>


      </google-codelab-step>
    
      <google-codelab-step label="無料利用枠について" duration="0">
        <h2 is-upgraded><strong>【補足】無料利用枠 (個人アカウントでご参加の方向け)</strong></h2>
<aside class="warning"><p><strong>ご自身の個人AWSアカウントでご参加されている方への補足</strong></p>
</aside>
<p>ハンズオンの一部は AWS 無料利用枠の範囲で進めることができます。また、ハンズオンが終了した後で、作成したリソースを全て削除すると課金はされません。</p>
<h3 is-upgraded><strong>&lt;1年間、以下範囲が毎月無料で利用できます&gt;</strong></h3>
<ul>
<li>EC2: Windows/Linux/RedHat など の t2.micro インスタンスを合計約 1ヶ月分</li>
<li>EBS: 合計 30GB の General Purpose (SSD) と 1GB のスナップショットを合計約 1ヶ月分</li>
<li>RDS: MySQL/PostgreSQL など を 20GB まで db.t2.micro インスタンスを合計約 1ヶ月分 (シングルAZ構成限定)</li>
<li>ALB: 合計約 1ヶ月分、15GB の処理 トラフィック:インターネットへのデータ送信 15GB</li>
</ul>
<p><a href="https://aws.amazon.com/jp/free/" target="_blank">AWS 無料利用枠</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="始める前に" duration="0">
        <h2 is-upgraded>スクリーンキャプチャに表示されている情報について</h2>
<p>リソースの各種 ID (vpc-XXXXXX、subnet-XXXXXX、i-XXXXXX など) は AWS 全体で ユニークとなっており、スクリーンキャプチャに記載の ID と実際に操作されて作成される ID は各自で異なります。</p>
<p>Elastic IP (固定IPアドレス) なども各自で異なります。</p>
<h2 is-upgraded>GUI インターフェイスデザインの変更について</h2>
<p>画面のデザイン等が変更されて実際とは異なっていることがあります。画面の項目名等から判断して操作下さい。</p>
<p>例えば、ホーム画面は少し前まで ↓ のデザインでしたが、</p>
<p class="image-container"><img alt="少し前のコンソール" style="width: 750.00px" src="img\\2c8c2811cbc00fe9"></p>
<p>↓ のようなデザインに変わりました。</p>
<p class="image-container"><img alt="2022年4月の最新コンソール" style="width: 750.00px" src="img\\17640a1f7d422d7f"></p>
<p>↓ もっと前はこのような画面の頃もありました。</p>
<p class="image-container"><img alt="随分前のコンソール" style="width: 750.00px" src="img\\d16aa47064933e34"></p>
<h2 is-upgraded>コマンドライン</h2>
<p>コマンドライン文は、なるべくコピペするようにしてください。</p>
<p>例えば、以下の SQL コードは wp_option テーブルにある option_name のカラムが「siteurl」か「home」のレコードだけ表示するコマンドですが、</p>
<pre><code>select * from wp_options where option_name=&#39;siteurl&#39; or option_name=&#39;home&#39;;</code></pre>
<p>誤って以下のように入力してしまうと、テーブルのデータが全部表示されてしまいます。</p>
<pre><code>select * from wp_options;</code></pre>
      </google-codelab-step>
    
      <google-codelab-step label="フェーズ1 - サインイン" duration="0">
        <h2 is-upgraded>サーバー 1 台構成</h2>
<p>最小構成で最も低コストですが、拡張性が低く、性能を一定以上上げることができません。</p>
<p class="image-container"><img alt="Phase1 完成図" style="width: 750.00px" src="img\\6eefc7b858788b64"></p>
<h3 is-upgraded><strong>拡張性: 低</strong></h3>
<p>拡張するには 1 台のインスタンスタイプを大きくします。</p>
<h3 is-upgraded><strong>冗長性: 低</strong></h3>
<p>インスタンスが稼働する物理サーバが壊れると一旦停止になりますが、同じアベイラビリティーゾーン内の問題の無いサーバですぐ起動できます。</p>
<h2 is-upgraded><strong>AWSマネジメントコンソールへのログイン</strong></h2>
<p><a href="https://console.aws.amazon.com/" target="_blank">https://console.aws.amazon.com</a> にブラウザでアクセスして、アカウントの E メールアドレスとパスワードでログインしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\a4dc7a53baf24c00"></p>
<p>サインインするとホーム画面が表示されます。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール ホーム画面" style="width: 750.00px" src="img\\360b910866c6647b"></p>
<p>左上の AWS アイコンをクリックするとホームに戻ります。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール ホーム画面 - ホーム" style="width: 750.00px" src="img\\d492d116952953d4"></p>
<p>サービスをクリックすると、EC2 や RDS といった各種 AWS サービス名へのリンクにアクセスできます。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール ホーム画面 - サービス" style="width: 750.00px" src="img\\4415c30de8e351ca"></p>
<p>テキストボックスにサービス名を入力することで候補が表示されるので便利です。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール ホーム画面 - テキスト検索ボックス" style="width: 750.00px" src="img\\863b1ad0ced8d09b"></p>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ1 - リージョンを変更" duration="0">
        <h2 is-upgraded><strong>リージョンを変更する (シンガポール)</strong></h2>
<p>AWS マネジメントコンソールに初めてサインインすると、「バージニア北部」リージョンが表示されます。練習で、シンガポールリージョンに移動してみたいと思います。</p>
<p>このリージョン名をクリックして候補から、アジアパシフィック (シンガポール) ap-southeast-1 を選択してください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール リージョン移動 - シンガポール" style="width: 750.00px" src="img\\565e22e02420af65"></p>
<h2 is-upgraded><strong>リージョンを変更する (シドニー)</strong></h2>
<p>画面遷移して「シンガポール」リージョンが表示されたら、次は「シドニー」リージョンに移動してみてください。「シンガポール」をクリックし、「アジアパシフィック (シドニー) ap-southeast-2」を選択してください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール リージョン移動 - シドニー" style="width: 750.00px" src="img\\3b1bd16d070886df"></p>
<h2 is-upgraded><strong>リージョンを変更する (東京)</strong></h2>
<p>リージョンの移動は完璧でしょうか。</p>
<p>それでは、本日構築する「東京」リージョンに移動してください。「シドニー」をクリックし、「アジアパシフィック (東京) ap-northeast-1」を選択してください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール  リージョン移動 - 東京" style="width: 750.00px" src="img\\3089ed7774828837"></p>
<h2 is-upgraded><strong>デフォルトリージョンを設定する</strong></h2>
<p>AWS マネジメントコンソールは「最後に利用したリージョン」を表示するようになっています。</p>
<p>これを変更するには、[<strong>設定</strong>] を開き、デフォルトリージョン の「最後に使用したリージョン」から希望のリージョンに変更してください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール  リージョン移動 - 東京" style="width: 750.00px" src="img\\51d0e2b20f88baf6"></p>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ1 - VPC" duration="0">
        <h2 is-upgraded><strong>VPC コンソールにアクセス</strong></h2>
<p>左上の サービス をクリックして、表示されたメニューから ネットワーキングとコンテンツ配信 をクリック、表示された VPC を選択します。</p>
<p>VPC コンソールに画面遷移します。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\366e3a210703c49b"></p>
<h2 is-upgraded><strong>VPC ウィザードで VPC コンポーネントを作成する</strong></h2>
<p>VPC コンソールが表示されたら、[<strong>VPC ウィザードを起動</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\f89e2003ff5312eb"></p>
<h2 is-upgraded><strong>VPC ウィザード - 全貌</strong></h2>
<p>VPC ウィザードは文字通り、画面の手順に沿ってクリックして進めていくと VPC が構築できる便利なウィザード機能です。</p>
<p>以前は画面が遷移していく形でしたが、2022年4月現在はリニューアルして 1 ページで収まらないほど大きな画面になりました。全貌は以下の画像の通りですが、順番に設定していきます。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\60165b219bb29bba"></p>
<p>まず 作成するリソース は「VPC、サブネットなど」を選択します。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\2a7d7f7d32b93ed5"></p>
<h2 is-upgraded><strong>VPC ウィザード - 名前タグ</strong></h2>
<p>次に、名前タグを設定します。テキストボックスに入力された「プロジェクト」を消して、「handsonyyyymmdd(今日の日付)」などの名前を入力してみてください。</p>
<p>右側に表示された VPC やサブネット、ルートテーブル、インターネットゲートウェイ、エンドポイントなどの名前タグが動的に設定されます。</p>
<p>以前のウィザードでは手入力だったので便利になりました。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\8f88d3ab5bfccdea"></p>
<h2 is-upgraded><strong>VPC ウィザード - IPv4 CIDR ブロック</strong></h2>
<p>本ハンズオンで作成する VPC のレンジは 10.0.0.0/16 にしますので、</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\2ae0a0d48b76f53d"></p>
<p>デフォルトで入力されている「10.0.0.0/16」のまま、次に進んでください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\9a9386f6efe57a26"></p>
<h2 is-upgraded><strong>VPC ウィザード - アベイラビリティーゾーン</strong></h2>
<p>アベイラビリティーゾーンは 2 のままで大丈夫です。AZ のカスタマイズから、どのアベイラビリティーゾーンを利用するか決めることができます。本ハンズオンでは、AZ-a と AZ-c を利用します。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\98f6b161179c37f8"></p>
<p>本ハンズオンでは、パブリックサブネットとプライベートサブネットを二つずつ作ります。設定値は以下になります。</p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>Public／Private</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>AZ</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>CIDR</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Public</p>
</td><td colspan="1" rowspan="1"><p>ap-northeast-1a</p>
</td><td colspan="1" rowspan="1"><p>10.0.0.0/24</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Public</p>
</td><td colspan="1" rowspan="1"><p>ap-northeast-1c</p>
</td><td colspan="1" rowspan="1"><p>10.0.1.0/24</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Private</p>
</td><td colspan="1" rowspan="1"><p>ap-northeast-1a</p>
</td><td colspan="1" rowspan="1"><p>10.0.2.0/24</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Private</p>
</td><td colspan="1" rowspan="1"><p>ap-northeast-1c</p>
</td><td colspan="1" rowspan="1"><p>10.0.3.0/24</p>
</td></tr>
</table>
<p class="image-container"><img style="width: 387.98px" src="img\\2a5f615c3d0f38f3"></p>
<h2 is-upgraded><strong>VPC ウィザード - NAT ゲートウェイ、VPC エンドポイント</strong></h2>
<p>NAT ゲートウェイは利用しません。</p>
<p>VPC エンドポイントも今回は利用しないので なし にしてください。</p>
<p>DNS オプションはどちらもチェックを入れてください。</p>
<p>[<strong>VPC を作成</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\ca25ed25f658b57f"></p>
<p>プレビューにも表示されている通り VPC、サブネット、ルートテーブル、インターネットゲートウェイが作成されます。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\111bf15c2b0a93c6"></p>
<p>VPC が作成されたら [<strong>VPC を表示</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\9f19aa9b2622a031"></p>
<h2 is-upgraded><strong>ウィザードで作成された VPC を確認</strong></h2>
<aside class="special"><p><strong>操作する VPC をフィルタリングしておくことで、他の VPC を操作する間違いを防ぐことができます。</strong></p>
</aside>
<p>[<strong>VPC を表示</strong>] ボタンをクリックすると、作成された VPC の詳細画面に遷移するので、左のメニューペインにある VPC のリンクをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\c062c8c5e85c9f3f"></p>
<p>左のメニューペインにある VPC でフィルタリング: のテキストボックスをクリックすると、候補が表示されますので、作成した VPC を選択してください。</p>
<aside class="warning"><p><strong>既存のVPC と間違わないように注意: VPC 作成後は表示されないケースもあるので、[F5] キーで画面更新していただくか、自分の VPC が特定できれば作業を割愛して OK です。</strong></p>
</aside>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\6d45a800474a3122"></p>
<p>作成した VPC だけがフィルタリングされて表示されます。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\4c81036370f58598"></p>
<aside class="special"><p><strong>メニューペインとの境界線にある ◀︎ アイコンをクリックすると、メニューペインを非表示にして操作画面を大きく表示できます。▶︎ アイコンをクリックすると、メニューペインを再表示できます。</strong></p>
</aside>
<p>先ほど作成した VPC が存在するか (正しく絞り込めているか) を確認してください。 この VPC の IPv4 CIDR が 10.0.0.0/16 であることを確認してください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\a809eef72bd67a75"></p>
<h2 is-upgraded><strong>ウィザードで作成されたサブネットを確認</strong></h2>
<p>左のメニューペインにあるサブネットをクリックします。</p>
<p>サブネット一覧が表示されますので、「public」と「AZ-a」の名前が記載されたリソースにチェックを入れてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\9e3cc576f4f4d0b1"></p>
<p>ページ下部のペインに詳細が表示されますので、アベイラビリティゾーンが ap-northeast-1a であること、IPv4 CIDR が 10.0.0.0/24 であることを確認してください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\7c4f169850c53c58"></p>
<h2 is-upgraded><strong>ウィザードで作成されたルートテーブルを確認</strong></h2>
<p>詳細ペインで、ルートテーブル のタブをクリックしてください。</p>
<p>VPC のネットワークアドレス 10.0.0.0/16 のターゲットが local に、 デフォルトルートの 0.0.0.0/0 のターゲットがインターネットゲートウェイ (igw-XXXX) になっており、インターネットと通信できる設定になっています。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\6871c5e065c7dff9"></p>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ1 - IAM ロールを作成する" duration="0">
        <h2 is-upgraded><strong>EC2 インスタンスにアタッチする IAM ロールを作成する</strong></h2>
<p>EC2 インスタンスには、Linux OS の場合は SSH で、Windows OS の場合は RDP で接続をしますが、本ハンズオンでは SSH ポートを開放せずに AWS Systems Manager のセッションマネージャー経由で接続をします。</p>
<aside class="special"><p><strong>セッションマネージャーを利用するには、IAM ロールが必要です。</strong></p>
</aside>
<p><strong>サービス</strong> から、<strong>セキュリティ、ID、およびコンプライアンス</strong> をクリックし、<strong>IAM</strong> を選択します。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\c4ea69a292628bea"></p>
<p>IAM コンソールに画面遷移したら、左側のメニューメインから <strong>ロール</strong> をクリックします。</p>
<p>ロール画面に遷移したら [<strong>ロールを作成</strong>] ボタンをクリックします。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\894e0ad1017259a6"></p>
<p>信頼されたエンティティタイプが <strong>AWS のサービス</strong> が選択されていること、ユースケースは EC2 が選択されていることを確認して、[<strong>次へ</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\6e25ab2b8ba0d3ff"></p>
<p>許可を追加 画面に推移するので、テキストボックスに AmazonSSMManagedInstanceCore を入力し、表示された <strong>AmazonSSMManagedInstanceCore</strong> のチェックボックスにチェックを入れて、[<strong>次へ</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\c1a4a6165b0831d3"></p>
<p><strong>ロール名</strong> には識別しやすい任意のロール名を入力してください。</p>
<p>ここでは、handson-ec2-role とします。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\bc7b5a458fff7ca2"></p>
<p>最下部まで進み、[<strong>ロールを作成</strong>] ボタンをクリックします。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\c9d370c09e58830d"></p>
<p>ロールが作成されたら、本ロールを SSM Agent が利用できるように設定します。</p>
<p>テキストボックスにロール名を入力し、ENTER キーを押下します。</p>
<p>ロールが表示されたら、リンクをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\5df67c1147cdb46"></p>
<p>ロールの詳細画面に遷移したら、[<strong>信頼関係</strong>] タブをクリックし、[<strong>信頼ポリシーを編集</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\784dd0669cc9d50f"></p>
<p>以下のような形でポリシーが表示されるので、</p>
<p>＜変更前＞</p>
<pre><code>
{
    &#34;Version&#34;: &#34;2012-10-17&#34;,
    &#34;Statement&#34;: [
        {
            &#34;Effect&#34;: &#34;Allow&#34;,
            &#34;Principal&#34;: {
                &#34;Service&#34;: &#34;ec2.amazonaws.com&#34;
            },
            &#34;Action&#34;: &#34;sts:AssumeRole&#34;
        }
    ]
}</code></pre>
<p>&#34;Service&#34;: [&#34;ec2.amazonaws.com&#34;,&#34;ssm.amazonaws.com&#34;] に書き換えてください。</p>
<p>＜変更後＞</p>
<pre><code>
{
        &#34;Version&#34;: &#34;2012-10-17&#34;,
        &#34;Statement&#34;: [
                {
                        &#34;Effect&#34;: &#34;Allow&#34;,
                        &#34;Principal&#34;: {
                                &#34;Service&#34;: [&#34;ec2.amazonaws.com&#34;,&#34;ssm.amazonaws.com&#34;]
                        },
                        &#34;Action&#34;: &#34;sts:AssumeRole&#34;
                }
        ]
}

</code></pre>
<p>ポリシーの記述に誤りがあると以下の通り誤りのある行に × 印でエラーマークが表示されます。エラーが消えるまで修正をしてください。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\41232b64143933d6"></p>
<p>ポリシーが変更できたら下部にある [<strong>ポリシーを更新</strong>] ボタンをクリックしてください。<br></p>
<p class="image-container"><img style="width: 750.00px" src="img\\bfa3d79594a93aec"></p>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ1 - EC2 インスタンスの作成" duration="0">
        <h2 is-upgraded>EC2 コンソールを開く</h2>
<p>左上のサービスボタンをクリックして、コンピューティングから EC2 を選択してください。</p>
<p>テキストボックスに入れていただいても候補が表示されます。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\6792d39b7b405b87"></p>
<p>EC2 コンソールに画面遷移したら [<strong>インスタンスを起動</strong>] ボタンをクリックしてください。</p>
<p>EC2 コンソールは旧いコンソールと新しいコンソールがあり、表示の仕方が異なる場合があります。ハンズオンは新しいコンソールで進めますので、左上のトグルボタンを下記の通りにして新しいコンソールになっていることを確認してください。</p>
<p class="image-container"><img style="width: 452.00px" src="img\\7d904885e745480d"></p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\f01162ae06e9b0b4"></p>
<p>[<strong>インスタンスを起動</strong>] のボタンが展開されるのでクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\3b98d2bcebe99726"></p>
<h2 is-upgraded>ステップ1: 名前とタグ</h2>
<p>インスタンスを区別できるようにタグに名前を設定します。</p>
<p>IAM ユーザを利用している場合、他ユーザと区別が付くように -user1 等ユーザ名を付けると良いでしょう。</p>
<p>ここでは、handson-ec2-wordpress-1 とします。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\1336d6390b435f15"></p>
<h2 is-upgraded>ステップ2: アプリケーションおよび OS イメージ (Amazon マシンイメージ)</h2>
<p>&#34;その他のAMIを閲覧する&#34;をクリックします。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\613d0acbc4e4d6c7"></p>
<p>本ハンズオンでは、Amazon Linux 2022 の AMI を利用します。</p>
<p>テキストボックスに以下の AMI ID を入力して、検索を行います。</p>
<p>コミュニティ AMI に該当の AMI があるので、選択ボタンを押下します。</p>
<pre><code>AMI 名:
al2022-ami-2022.0.20220315.0-kernel-5.15-x86_64
AMI ID:
ami-082c70eb5ed5441a1
※ 東京リージョンの AMI ID です。</code></pre>
<p class="image-container"><img style="width: 750.00px" src="img\\2b671fad477db309"></p>
<p>選択後に以下の様な表示に切り替わります。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\6d0f587ca9ef40db"></p>
<h2 is-upgraded>ステップ3: インスタンスタイプ</h2>
<p>インスタンスタイプは、無料利用枠の「t2.micro」を選択します。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\d86c7a66a761d3db"></p>
<h2 is-upgraded>ステップ4: キーペア（ログイン）</h2>
<p>セッションマネージャーを利用するため、本ハンズオンではキーペアは利用しません。</p>
<p>[<strong>キーペアなしで続行（推奨させません）</strong>] を選択します。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\c403850b8cda5a99"></p>
<h2 is-upgraded>ステップ5: ネットワーク設定</h2>
<p>[<strong>編集</strong>] ボタンを押下し、以下の設定をお願いします。</p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>値</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>VPC</p>
</td><td colspan="1" rowspan="1"><p>本日を作成したVPCを設定下さい</p>
<p>手順書通りなら「handson20220425-vpc」となります。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>サブネット</p>
</td><td colspan="1" rowspan="1"><p>*-public1-ap-northeast-1aと記載されたサブネットを設定下さい</p>
<p>手順書通りなら「handson20220425-subnet-public1-ap-northeast-1a」となります。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>パブリックIPの自動割り当て</p>
</td><td colspan="1" rowspan="1"><p>有効化</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>ファイアウォール（セキュリグループ）</p>
</td><td colspan="1" rowspan="1"><p>セキュリティグループを作成する</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>セキュリティグループ名</p>
</td><td colspan="1" rowspan="1"><p>web-sg</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>説明</p>
</td><td colspan="1" rowspan="1"><p>web-sg</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>タイプ</p>
</td><td colspan="1" rowspan="1"><p>HTTP</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>ソースタイプ</p>
</td><td colspan="1" rowspan="1"><p>自分のIP</p>
</td></tr>
</table>
<p class="image-container"><img style="width: 750.00px" src="img\\a167a83f855b092"></p>
<h2 is-upgraded>ステップ5: ストレージを設定</h2>
<p>画面右上のアドバンストをクリックします</p>
<p class="image-container"><img style="width: 750.00px" src="img\\469782cdfff77dd3"></p>
<p>IOPSに3000を設定します。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\aeb0a66ed4c56ad5"></p>
<h2 is-upgraded>ステップ6: 高度な詳細</h2>
<p>以下の設定をお願いします。</p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>値</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>IAM インスタンスプロフィール</p>
</td><td colspan="1" rowspan="1"><p>本日を作成したRoleを設定下さい</p>
<p>手順書通りなら「handson-ec2-role」となります。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>クレジット仕様</p>
</td><td colspan="1" rowspan="1"><p>スタンダード</p>
<p>（無制限の場合、t 系インスタンスで CPU クレジットが枯渇した際に予想以上のコストがかかる場合があります。）</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>ユーザーデータ</p>
</td><td colspan="1" rowspan="1"><p>（以下をコピペ）</p>
</td></tr>
</table>
<pre><code>#!/bin/bash
dnf -y update
# WordPress のインストールを完了させるため、SELinux を一時的にPermissive に変更
setenforce 0

# WordPress のRDS切り替えを完了させるため、SELinux を恒久的に Permissive に変更
grubby --update-kernel ALL --args enforcing=0

# タイムゾーンを東京に変更
timedatectl set-timezone Asia/Tokyo
localectl set-locale LANG=ja_JP.utf8

# SSM Agent インストール
dnf install -y https://s3.amazonaws.com/ec2-downloads-windows/SSMAgent/latest/linux_amd64/amazon-ssm-agent.rpm
systemctl enable amazon-ssm-agent
systemctl start amazon-ssm-agent

# Nginx インストール
dnf install -y nginx

# php インストール
dnf install -y php
dnf install -y php-mbstring php-devel php-gd php-pdo php-xml php-mysqlnd php-json

# PHP FastCGI インストール
dnf install -y php-fpm

#php-fpm 設定変更
sed -i -e &#34;s/user = apache/user = nginx/g&#34; /etc/php-fpm.d/www.conf
sed -i -e &#34;s/group = apache/group = nginx/g&#34; /etc/php-fpm.d/www.conf
systemctl enable php-fpm.service
systemctl start php-fpm.service

# mariadb インストール
dnf install -y mariadb105-server
systemctl start mariadb
systemctl enable mariadb
mysql -u root -e &#34;create database wp_database; grant all privileges on wp_database.* to wp_admin@localhost identified by &#39;wordpress&#39;;&#34;

# WordPress インストール
cd /usr/share/nginx/html/
wget https://ja.wordpress.org/latest-ja.tar.gz
tar -xzf latest-ja.tar.gz
rm -f latest-ja.tar.gz
chown -R nginx. /usr/share/nginx/html

# WordPress ディレクトリとフォルダーの権限設定
find /usr/share/nginx/html/wordpress -type d -exec chmod 705 {} +
find /usr/share/nginx/html/wordpress -type f -exec chmod 604 {} +

# WordPress 用の Nginx 設定ファイル
cat &lt;&lt; EOS &gt;&gt; /etc/nginx/conf.d/wordpress.conf
server {
        index index.php index.html;
        root /usr/share/nginx/html/wordpress;

        location ~* /wp-config.php {
                deny all;
        }

        location / {
                try_files \$uri \$uri/ /index.php\$is_args$args;
        }

        location ~ \.php\$ {
                include fastcgi.conf;
                fastcgi_pass   unix:/run/php-fpm/www.sock;
        }
}
EOS

# Nginx スタート
systemctl enable nginx.service
systemctl start nginx.service</code></pre>
<p class="image-container"><img style="width: 750.00px" src="img\\ee2f4c1a7dd70a7e"></p>
<p class="image-container"><img style="width: 750.00px" src="img\\3fa081485ca016b"></p>
<p class="image-container"><img style="width: 750.00px" src="img\\6bd652204ca4de32"></p>
<h2 is-upgraded>ステップ7: 概要</h2>
<p>「インスタンスを起動」ボタンを押下します</p>
<p class="image-container"><img style="width: 410.00px" src="img\\b44416f146288bc8"></p>
<p>以下のような画面になれば成功です。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\c24b4f306fb12970"></p>
<p>インスタンスの作成が完了するのを待ちます。</p>
<p>ステータスが「利用可能」になるまで数分かかります。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール  リージョン移動 - 東京" style="width: 750.00px" src="img\\39f48ad0d48e1537"></p>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ1 - セッションマネージャー" duration="0">
        <h2 is-upgraded><strong>セッションマネージャー経由で EC2 インスタンスにアクセスする</strong></h2>
<p>起動したインスタンスは、AMI (Amazon マシンイメージ) から復元されたあと、ユーザーデータに入力したスクリプトによって、インストールが行われていきます。</p>
<p>下図の通り、</p>
<ul>
<li>インスタンスの状態が <strong>実行中</strong> になること</li>
<li>ステータスチェックが 2/2 のチェックに合格しました</li>
</ul>
<p>になることを確認してください。(これには数分かかります。)</p>
<p class="image-container"><img style="width: 750.00px" src="img\\9d07b7e47a063e8"></p>
<p>また、バックグラウンドでは並行してユーザーデータによるインストールが進行していきます。</p>
<p>インストールが完了するまで少し時間がかかりますが、このインストールの途中でセッションマネージャーが利用できる状態になります。</p>
<aside class="warning"><p><strong>Amazon Linux 2022 には 2022 年 4 月の段階で、セッションマネージャーを利用するための Systems Manager Agent がプリインストールされていません。そのため、本ハンズオンではユーザーデータを使って Agent をインストールしています。</strong></p>
</aside>
<h2 is-upgraded><strong>ユーザーデータで行う処理</strong></h2>
<ol type="1" start="1">
<li><strong>SELinux 無効化<br></strong>Amazon Linux 2022 は Fedora ベースの OS で SELinux が有効になっています。<br>SELinux が有効だとセットアップ時に Nginx が正しく動作しません。<br>本番環境では SELinux を有効化して http などのポリシーの設定を行う必要がありますが、本ハンズオンでは無効化します。</li>
<li><strong>タイムゾーンを東京に変更<br></strong>Amazon Linux 2022 の AMI は UTC 時刻にて稼働します。そのため、起動後にタイムゾーンを UTC+9 (Asia/Tokyo) にします。</li>
<li><strong>ロケールを日本語に変更</strong></li>
<li><strong>SSM エージェントのインストール<br></strong>SSM エージェントをインストールすると、セッションマネージャーが利用できるようになります。</li>
<li><strong>Nginx インストール<br></strong>Web サーバーとして稼働させるため、Nginx をインストールします。</li>
<li><strong>php インストール<br></strong>WordPress の稼働に必要な PHP と PHP モジュールをインストールします。</li>
<li><strong>MariaDB インストール<br></strong>WordPress で利用する MariaDB をインストールします。</li>
<li><strong>WordPress インストール<br></strong>最新版の WordPress をダウンロードしてインストールします。</li>
</ol>
<aside class="special"><p><strong>SELinux は、Passive という警告モードにしています。</strong></p>
</aside>
      <h2 is-upgraded><strong>セッションマネージャーによる接続</strong></h2>
        <p>インスタンスが起動したらセッションマネージャーで接続してみましょう。</p>
<p>EC2 コンソールの左側のメニューペインにある インスタンス をクリックして、右側に表示されるインスタンス一覧から、起動したインスタンスを見つけてください。</p>
<p>インスタンスの左側にあるチェックボックスにチェックを入れて、[<strong>接続</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\161dfbb3c8556583"></p>
<p>インスタンスが複数表示されている場合は、テキストボックスにインスタンス名を入れたり、ステータスを <strong>running</strong> でフィルタリングするなどすると効率的に見つけることができます。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\bfd47040537e6316"></p>
<p>[<strong>セッションマネージャー</strong>] タブを選択し、[<strong>接続</strong>] ボタンをクリックします。</p>
<aside class="warning"><p><strong>接続ボタンがアクティブでない場合は、IAM ロールをアタッチし損ねたか、パブリック IP アドレスをつけ忘れたか、SSM エージェントのインストールがまだ完了していないなどの可能性があります。</strong></p>
</aside>
<h3 is-upgraded><img style="width: 750.00px" src="img\\a20ceeba4c2c1a49"></h3>
<p>接続が成功すると、ブラウザの新しいタブが開いて以下のようなプロンプトで停止します。</p>
<pre><code>sh-5.1$</code></pre>
<p>スイッチユーザーして、root ユーザーに昇格してください。</p>
<pre><code>sh-5.1$ sudo -i
#
</code></pre>
<p>本ウインドウは閉じずにそのままにしておいてください。</p>
<h2 is-upgraded><strong>セッションマネージャーによる接続がうまくいかない場合</strong></h2>
<p>インスタンスは完全に起動完了していますでしょうか。ステータスチェックは 2/2 になっていますか？</p>
<p>起動時に指定した内容どおりに起動しているでしょうか?</p>
<p>接続先のインスタンス ID は正しいですか？</p>
<aside class="warning"><p><strong>バックグラウンドでインストールが継続している可能性があります。再起動などは実施しないでください。 次の手順 (ブラウザからアクセス) で、WordPress のウェルカム画面が表示されれば、インストールは一通り終わっています。</strong></p>
</aside>
      </google-codelab-step>
    
      <google-codelab-step label="フェーズ1 - ブラウザで http アクセスする" duration="0">

        <aside class="special"><p><strong>WordPress が利用可能になるまでは EC2 起動から 10〜15 分程度かかります。</strong></p>
        </aside>
        
        <p>次はブラウザから Web ページにアクセスしてみます。</p>
<p>EC2 コンソールでインスタンスを選択したら、下部の詳細ペインに表示された <strong>パブリック IPv4 アドレス</strong> を見つけて、アドレスの左側にあるアイコンをクリックしてください。IP アドレスがクリップボードにコピーされます。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\4f1618064567a6a"></p>
<p>Chrome タブを追加して、アドレスバーに貼り付けて、ENTER キーを押下しアクセスしてください。WordPress のセットアップ・ウェルカムページが表示されます。</p>
<aside class="warning"><p><strong>ページが表示されない場合は、セキュリティグループの設定に誤りがある可能性があります。</strong></p>
</aside>
<p class="image-container"><img style="width: 750.00px" src="img\\229b2cecadc578c9"></p>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ1 - Elastic IP の割り当て" duration="0">
        <h2 is-upgraded><strong>Elastic IP (EIP) を取得</strong></h2>
<aside class="warning"><p><strong>バックグラウンドでインストールが継続している可能性があります。インストール中に ElasticIP アドレスを付与すると処理エラーが発生する可能性があります。 前の手順 (ブラウザからアクセス) で、WordPress のウェルカム画面が表示されれば、インストールは一通り終わっています。</strong></p>
</aside>
<p>インスタンスを停止/開始した後も、同じ IP アドレスが使用できるよう、固定 IP アドレスであるElastic IP を取得します。</p>
<p>EC2 コンソールにて、左側のメニューペインから <strong>Elastic IP</strong> をクリックし、ページ上部に表示された [<strong>Elastic IP アドレスを割り当てる</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\6aa90055d6f13889"></p>
<p><strong>Elastic IP アドレスを割り当てる</strong> の画面に遷移するので、Name タグを設定してください。<strong> ページの下部にある タグ - オプション</strong> に進み、[<strong>新規タグ追加</strong>] ボタンをクリックします。 キーと値に以下を入力してください。</p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>キー</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>値</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Name</p>
</td><td colspan="1" rowspan="1"><p>handson-ec2-wordpress-1</p>
</td></tr>
</table>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\ea102acb923a2e9d"></p>
<aside class="special"><p><strong>タグは任意ですが、EC2 インスタンスのタグと揃えると識別しやすいです。</strong></p>
</aside>
<p>Elastic IP アドレスが割り当てられたら、割り当てられた IPv4 アドレスを控えておいてください。</p>
<p>メモができたら、上図の緑のラインに表示されている [<strong>この Elastic IP アドレスを関連づける</strong>] をクリックしてください。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\bd094f74e9e195c6"></p>
<aside class="special"><p>上図の緑のラインにある ([<strong>この Elastic IP アドレスを関連づける</strong>] ボタンが消えてしまった場合は) [<strong>アクション</strong>] ボタンをクリックして、[<strong>Elastic IPアドレスの関連付け</strong>] を選択してください。</p>
</aside>
<p><strong>インスタンス</strong> に起動した EC2 インスタンスを指定し、プライベート IP アドレスを選択して、[<strong>関連付ける</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\d00f05761dec9e27"></p>
<aside class="warning"><p>前述の作業で取得した自分の IP アドレスが表示されている事を確認の上、選択してください。 EC2 インスタンスが複数ある場合は誤ったインスタンスにアタッチしないようにご注意ください。</strong></p>
</aside>
<p>アタッチしたアドレスは、EC2 の詳細画面からも確認できますので再度チェックしておいてください。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\4f1618064567a6a"></p>
<aside class="warning"><p><strong>繋がらない方は、払い出した Elastic IP アドレスと一致していることを確認してください。Elastic IP アドレスをアタッチした直後は画面が更新されていない可能性があります。</strong></p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ1 - WordPress の構成" duration="0">
        <h2 is-upgraded><strong>MySQL と Nginx が動いていることを確認</strong></h2>
<p>先ほど接続したセッションマネージャーのブラウザタブに戻り、MySQL と Nginx が動いていることを確認したいと思います。</p>
<p>以下の root 権限にて、</p>
<pre><code>sh-5.1$ sudo -i
#</code></pre>
<p>以下コマンドを入力してください。</p>
<pre><code>systemctl status mariadb</code></pre>

<p>以下のような running ステータスが返れば正常に起動しています。</p>
<pre><code># systemctl status mariadb
● mariadb.service - MariaDB 10.5 database server
     Loaded: loaded (/usr/lib/systemd/system/mariadb.service; disabled; vendor preset: disabled)
     Active: active (running) since Wed 2022-04-06 21:16:03 JST; 1h 48min ago
       Docs: man:mariadbd(8)
             https://mariadb.com/kb/en/library/systemd/
   Main PID: 29016 (mariadbd)
     Status: &#34;Taking your SQL requests now...&#34;
      Tasks: 8 (limit: 1096)
     Memory: 64.7M
        CPU: 1.324s
     CGroup: /system.slice/mariadb.service
             └─29016 /usr/libexec/mariadbd --basedir=/usr

 4月 06 21:16:03 ip-10-0-0-44.ap-northeast-1.compute.internal mariadb-prepare-db-dir[28974]: See the MariaDB Knowledgebase at&gt;

 (中略)

 4月 06 21:16:03 ip-10-0-0-44.ap-northeast-1.compute.internal systemd[1]: Started MariaDB 10.5 database server.
lines 1-23/23 (END)</code></pre>
<p>コマンドを投入したあとに以下のような画面で操作できない方は、キーボードの [Q] キーを押下すると抜けることができます。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\70e19a85009c81bf"></p>

<p>続いて、Nginx サーバーを確認します。</p>
<p>以下のコマンドを入力してください。</p>
<pre><code>systemctl status nginx</code></pre>
<p>以下のような running ステータスが返れば正常に起動しています。</p>
<pre><code># systemctl status nginx
● nginx.service - The nginx HTTP and reverse proxy server
     Loaded: loaded (/usr/lib/systemd/system/nginx.service; enabled; vendor preset: disabled)
    Drop-In: /usr/lib/systemd/system/nginx.service.d
             └─php-fpm.conf
     Active: active (running) since Wed 2022-04-06 21:16:16 JST; 1h 47min ago
    Process: 29098 ExecStartPre=/usr/bin/rm -f /run/nginx.pid (code=exited, status=0/SUCCESS)
    Process: 29099 ExecStartPre=/usr/sbin/nginx -t (code=exited, status=0/SUCCESS)
    Process: 29100 ExecStart=/usr/sbin/nginx (code=exited, status=0/SUCCESS)
   Main PID: 29101 (nginx)
      Tasks: 3 (limit: 1096)
     Memory: 5.9M
        CPU: 61ms
     CGroup: /system.slice/nginx.service
             ├─29101 nginx: master process /usr/sbin/nginx
             ├─29102 nginx: worker process
             └─29103 nginx: worker process

 4月 06 21:16:16 ip-10-0-0-44.ap-northeast-1.compute.internal systemd[1]: Starting The nginx HTTP and reverse proxy server...
 
 (中略)
 
 4月 06 21:16:16 ip-10-0-0-44.ap-northeast-1.compute.internal systemd[1]: Started The nginx HTTP and reverse proxy server.
lines 1-21/21 (END)</code></pre>
<p>コマンドを投入したあとに以下のような画面で操作できない方は、キーボードの [Q] キーを押下すると抜けることができます。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\70e19a85009c81bf"></p>
      </google-codelab-step>
    
      <google-codelab-step label="フェーズ1 - WordPress の初期設定" duration="0">
        <p>http://&lt;Elastic IPアドレス&gt;/wordpress/ を開いて、WordPressの初期設定を始めます。</p>
<p>上記 URL にアクセスすると、自動で setup-config.php にリダイレクトします。</p>
<p>[<strong>さあ、始めましょう!</strong>] ボタンをクリックします。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\45ec6dc8d287f67a"></p>
<h2 is-upgraded>作成した MySQL の DB 設定に基づき、設定します。</h2>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>値</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>データベース名</p>
</td><td colspan="1" rowspan="1"><p>wp_database</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>ユーザー名</p>
</td><td colspan="1" rowspan="1"><p>wp_admin</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>パスワード</p>
</td><td colspan="1" rowspan="1"><p>wordpress</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>データベースのホスト名</p>
</td><td colspan="1" rowspan="1"><p>localhost</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>テーブル接頭辞</p>
</td><td colspan="1" rowspan="1"><p>wp_</p>
</td></tr>
</table>
<p>以下の画面が表示されるので、上記の値を入力して、[<strong>送信</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\206af0938320277d"></p>
<p>以下画面に遷移するので、[<strong>インストール実行</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\592c12573ebca0a4"></p>
<p>以下画面に遷移するので、パスワードを除いて、画像の通り入力してください。</p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>値</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>サイトのタイトル</p>
</td><td colspan="1" rowspan="1"><p>はじめてのAWS</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>ユーザー名</p>
</td><td colspan="1" rowspan="1"><p>admin</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>パスワード</p>
</td><td colspan="1" rowspan="1"><p>（初期設定のまま）</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>メールアドレス</p>
</td><td colspan="1" rowspan="1"><p>abc@example.com</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>検索エンジンでの表示</p>
</td><td colspan="1" rowspan="1"><p>チェックを入れる</p>
</td></tr>
</table>
<p>[<strong>WordPress をインストール</strong>] ボタンをクリックしたあと、20 秒程度かかります。</p>
<p>ブラウザのローディングが終わるまで、リロードなど行わずに少々お待ちください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\3acdc45d40ef1337"></p>
<p>以下の画面が表示されたらセットアップ完了です。</p>
<p>[<strong>ログイン</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\6862e74858626cb4"></p>
<h2 is-upgraded>WordPress ログイン画面</h2>
<p>以下、ログイン画面が表示されるので先ほど入力したユーザー名とパスワードを入力してください。</p>
<p>[<strong>ログイン</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\1373a94d6c1078f3"></p>
<h2 is-upgraded>WordPress 管理者画面</h2>
<p>ユーザー名とパスワードが正しく入力され、認証が通れば WordPress の管理者画面が表示されます。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\59f33d2f7d793db5"></p>
<ol type="1" start="1">
<li>[<strong>投稿</strong>] をクリックして、任意の新規ブログポストを書くことができます。<br><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\44f40a96071d1cdc"></li>
<li>ブログタイトルをクリックするとブログが表示できます。<br><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\97d0ac91af2d5c06"></li>
</ol>
<h2 is-upgraded>ブログの起動確認</h2>
<p>Wordpress ブログが実行できていることを確認します。</p>
<p>(nginxの画面が出る場合はリロードしてみてください)</p>
<p>前ページの管理画面に戻るには <a href="http://eiastic" target="_blank">http:// EIastic</a> IP アドレス /wp-admin/ にアクセスします。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\6070997e65add016"></p>


      </google-codelab-step>
    
      <google-codelab-step label="座学 - Amazon Aurora" duration="0">
        <p class="image-container"><img style="width: 750.00px" src="img\\834f3a8671e444f1.png"></p>
<p>Amazon Aurora は、クラウド向けに AWS が構築したデータベースです。</p>
<p>MySQL と PostgreSQL と互換性があります。</p>
<p>Aurora の DB クラスターは 1 つ以上の DB インスタンスと、データを管理するクラスターボリュームで構成され、データボリュームは 3 AZ に 3 個ずつ計 6 個のコピーが作成され、高い耐障害性を持ちます。</p>
<p>また、通常の RDS 同様にバックアップやフェイルオーバーに対応した DB を数クリックで利用可能にします。</p>
<p>メンテナンスフリーで、自動バックアップや、パッチ当てなどが自動で行われます。</p>
<p class="image-container"><img style="width: 695.50px" src="img\\bb05d0531ca1039b"></p>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ2" duration="0">
        <h2 is-upgraded>フェーズ2の作成範囲について</h2>
<p>フェーズ2は以下の範囲の作成を実施します。</p>
<p class="image-container"><img style="width: 700.50px" src="img\\c25977e23e65624f"></p>
<h2 is-upgraded><strong>フェーズ2：Web + DB (サーバー 2台構成)</strong></h2>
<p>拡張性が少し高くなり、DBの運用が楽になります。</p>
<p>◆拡張性：中</p>
<p>拡張方法はフェーズ 1 と変わらず、インスタンスタイプを大きくします。</p>
<p>2 台構成のため、フェーズ 1 よりも最大構成で対応できる規模が大きくなります。</p>
<p>◆冗長性：中</p>
<p>Amazon Aurora 自体はシングル AZ 上で構成されるものの、データそのものはデータクラスターの単位で各 AZ 上に分割される為、データの冗長性は向上します。</p>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ2 - RDS セキュリティグループを作成" duration="0">
        <h2 is-upgraded><strong>DB 用のセキュリティグループ</strong></h2>
<p>DB へのアクセスを許可するソースには、IP アドレスではなく Web サーバー用のセキュリティグループを指定します。</p>
<p>こうする事で DB は Web サーバーからのアクセスのみ許可されます。</p>
<p class="image-container"><img style="width: 699.60px" src="img\\c0399b06be6c1e25"></p>
<h2 is-upgraded><strong>DB 用のセキュリティグループを作成</strong></h2>
<p>EC2 のウィザードからセキュリティグループを選択し、以下の手順で実施します。</p>
<p class="image-container"><img style="width: 710.27px" src="img\\25d7112c7daacfc3"></p>
<p>セキュリティグループ作成画面で以下を入力します。</p>
<p>・セキュリティグループ名：db-sg</p>
<p>・説明：Aurora for MySQL</p>
<p>・VPC：自分で作成したVPCを選択します。</p>
<aside class="special"><p><strong>異なる VPC が選択されている場合は右側の × アイコンで選択解除すると候補が表示されます。</strong></p>
</aside>
<p class="image-container"><img style="width: 703.11px" src="img\\7bb6de95f6e3792"></p>
<p>インバウンドルールに [<strong>MySQL/Auror</strong>a] を選択し、web-sg を対象として選択し、セキュリティグループを作成します。</p>
<p class="image-container"><img style="width: 693.50px" src="img\\cac0ed872d4eabe7"></p>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ2 - DB サブネットグループを作成" duration="0">
        <h2 is-upgraded><strong>RDS 管理ページを開く</strong></h2>
<p>サービスからデータベースを選択し、RDSをクリックします。</p>
<p class="image-container"><img style="width: 696.50px" src="img\\880c0a2310dcbc62"></p>
<h2 is-upgraded><strong>DB サブネットグループを作成</strong></h2>
<p>RDS の管理画面からサブネットグループを選択し、DB サブネットグループの作成をクリックします。</p>
<p class="image-container"><img style="width: 703.69px" src="img\\77edbc2c08b54635"></p>
<p>DB サブネットグループの作成画面で以下を入力します。</p>
<p>・名前：db-subnet</p>
<p>・説明：Aurora for MySQL</p>
<p>・VPC：作成したVPCを選択します。</p>
<p class="image-container"><img style="width: 694.50px" src="img\\2848484e792f093b"></p>
<p>サブネットを追加の項目では、</p>
<p>アベイラビリティゾーンでは、[<strong>ap-northeast-1a</strong>] と [<strong>ap-northeast-1c</strong>] を選択します。</p>
<p>サブネットでは、[<strong>10.0.2.0/24</strong>] と [<strong>10.0.3.0/24</strong>] の 2 つを選択します。</p>
<p class="image-container"><img style="width: 706.50px" src="img\\29cd1183b185701e"></p>
<p>作成したサブネットグループが存在する事を確認します。</p>
<p class="image-container"><img style="width: 709.91px" src="img\\1266479f0e4947e0"></p>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ2 - Aurora インスタンスを作成" duration="0">
        <h2 is-upgraded><strong>Aurora インスタンスを作成</strong></h2>
<p>Amazon Aurora のライターインスタンスを作成します。RDS の管理画面からデータベースをクリックし、データベースの作成をクリックします。</p>
<p class="image-container"><img style="width: 707.50px" src="img\\ebf5c8f6b3e33a42"></p>
<p>データベースの作成で以下を選択、入力します。</p>
<p>・データベースの作成方法：標準作成</p>
<p>・エンジンのオプション：Amazon Aurora</p>
<p>・エディション：MySQL互換エディション</p>
<p class="image-container"><img style="width: 696.50px" src="img\\358d3d02a04a221e"></p>
<p>続けて以下の内容を選択します。</p>
<p>・<strong>レプリケーション機能</strong>を展開して、<strong>シングルマスター</strong>を選択します。</p>
<p>・利用可能なバージョン：<strong>[Aurora(MySQL 5.7) 2.10.2] </strong>を選択します。(デフォルトで設定されているバージョンではない可能性があります)</p>
<p class="image-container"><img style="width: 750.00px" src="img\\25a97b64a7fcd0d9"></p>
<p>・テンプレート：開発/テストを選択します。<img style="width: 707.00px" src="img\\ce04e7d599c68719"></p>
<p>続けて、設定画面において、以下を入力します。</p>
<p>・DBクラスター識別子：aurora-mysql-db</p>
<p>・マスターユーザー名：admin</p>
<p>・パスワード：wordpress</p>
<p class="image-container"><img style="width: 708.50px" src="img\\4758b869ee7ceea1"></p>
<p>DBインスタンスクラスは <strong>バースト可能クラス</strong> を選択し、<strong>db.t3.small</strong> を選択します。</p>
<p>可用性と耐久性の箇所では「Auroraレプリカを作成しない」を選択します。</p>
<p class="image-container"><img style="width: 701.50px" src="img\\d0748adeb266d544"></p>
<p>接続の箇所は以下のように入力します。</p>
<p>・VPC：作成したVPCを選択します。</p>
<p>・サブネットグループ：db-subnetを選択します。</p>
<p>・パブリックアクセス：なし</p>
<p>・VPCセキュリティグループ：既存の選択を選び、db-sgのみを選択します。</p>
<p class="image-container"><img style="width: 711.50px" src="img\\185b257a6f367567"></p>
<p>アベイラビリティゾーンは [<strong>ap-northeast-1a</strong>] を選択し、</p>
<p>データベース認証はパスワード認証を選択します。</p>
<p>追加設定から最初のデータベース名に「<strong>wp_database</strong>」を入力します。</p>
<p>「<strong>DBクラスターのパラメータグループ</strong>」以下、メンテナンスウインドウの設定まではデフォルト設定のままとしてください。</p>
<p class="image-container"><img style="width: 704.50px" src="img\\43f07c2ac4b466c5"></p>
<p>設定画面の最下部にある削除保護の有効化のチェックを外し、</p>
<p>[<strong>データベースの作成</strong>]をクリックします。</p>
<p class="image-container"><img style="width: 717.73px" src="img\\635204050191800e"></p>
<p>インスタンスの作成が完了するのを待ちます。</p>
<p>ステータスが「利用可能」になるまで、数分かかります。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール  リージョン移動 - 東京" style="width: 750.00px" src="img\\39f48ad0d48e1537"></p>
<h2 is-upgraded><strong>作成した Aurora インスタンス を確認</strong></h2>
<p>インスタンスの作成が完了するのを待ちます。</p>
<p>[<strong>データベース</strong>] に表示されるリージョン別クラスターとライターインスタンスのステータスが [<strong>利用可能</strong>] になるまで数分かかります。</p>
<p class="image-container"><img style="width: 704.05px" src="img\\41e2379f029b300f"></p>
<p>[<strong>データベース</strong>] に表示されている利用可能となったリージョン別クラスターを選択する</p>
<p class="image-container"><img style="width: 702.48px" src="img\\46c5a05d9d9d36bb"></p>
<p>ライターインスタンスのエンドポイント名をコピーしてメモする</p>
<p class="image-container"><img style="width: 705.50px" src="img\\baf7289052d4113d"></p>
<h2 is-upgraded><strong>作成した Aurora DB への接続確認</strong></h2>
<p>Web サーバの EC2 インスタンスから Aurora DB に接続出来る事を確認します。</p>
<aside class="special"><p><strong>endpoint は先ほどメモした Aurora クラスターのライターインスタンスのエンドポイント名部分を入れてください。</strong></p>
</aside>
<p>パスワードを求められるので、wordpress と入力します。</p>
<pre><code># mysql -u admin -p -h endpoint
Enter password: wordpress

mysql&gt; show databases;

+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
4 rows in set (0.004 sec)

mysql&gt; exit</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ2 - MySQLのデータを移行" duration="0">
        <h2 is-upgraded><strong>EC2 上の MySQL のデータをエクスポート</strong></h2>
<p>EC2 インスタンス上にインストールされている MySQL からデータをエクスポートします。</p>
<pre><code># cd /tmp/
# pwd
/tmp
# mysqldump -u root -p wp_database &gt; export.sql
Enter password: wordpress</code></pre>

<p>エクスポートできたか確認します。</p>

<pre><code>
# ls -l export.sql
-rw-r--r--. 1 root root 295916  4月 24 14:40 export.sql
</code></pre>

<p>export.sql がエクスポートできたら、EC2 インスタンス上の MySQL は今後使わないため停止します。</p>
<pre><code># systemctl stop mariadb
# systemctl disable mariadb</code></pre>
<h2 is-upgraded><strong>EC2 上の MySQL のデータを Aurora にインポート</strong></h2>
<p>エクスポートしたデータ (export.sql) を Aurora にインポートします。</p>
<aside class="special"><p><strong>endpoint は先ほどメモした Aurora クラスターのライターインスタンスのエンドポイント名部分を入れてください。</strong></p>
</aside>
<pre><code># mysql -u admin -p -h endpoint wp_database &lt; export.sql
Enter password:wordpress
</code></pre>
<aside class="warning"><p><strong>※データベースが存在しないエラーが出た場合は、Aurora 作成時にデータベースが作成できていない可能性があります。RDS ログイン後に create database wp_database; を実行して再試行してください。</strong></p>
</aside>
<p>インポートされた事を確認します。</p>
<aside class="special"><p><strong>endpoint は先ほどメモした Aurora クラスターのライターインスタンスのエンドポイント名部分を入れてください。</strong></p>
</aside>
<pre><code>$ mysql -u admin -p -h endpoint wp_database
Enter password:wordpress

mysql&gt; show tables;
+-----------------------+
| Tables_in_wp_database |
+-----------------------+
| wp_commentmeta        |
| wp_comments           |
| wp_links              |
| wp_options            |
| wp_postmeta           |
| wp_posts              |
| wp_term_relationships |
| wp_term_taxonomy      |
| wp_termmeta           |
| wp_terms              |
| wp_usermeta           |
| wp_users              |
+-----------------------+
12 rows in set (0.001 sec)

mysql&gt; exit
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ2 - WordPress の DB 接続設定" duration="0">
        <h2 is-upgraded><strong>WordPressのDB接続設定を削除</strong></h2>
<p>再設定をWebから行うため、DB接続設定を初期化します。</p>
<p>設定ファイル(wp-config.php)をホームディレクトリに移動させます。こうすることで<code>/usr/share/nginx/html/wordpress/</code> から設定ファイルが消え、設定が初期化されます。</p>
<pre><code># mv /usr/share/nginx/html/wordpress/wp-config.php ~/</code></pre>
<h2 is-upgraded><strong>WordPressの再設定</strong></h2>
<p>http://&lt;Elastic IPアドレス&gt;/ を開いて、WordPressの初期設定を始めます。</p>
<p class="image-container"><img style="width: 703.50px" src="img\\3ace787597f2edf"></p>
<p>作成した Aurora の DB 設定に基づき、設定します。</p>
<p>フェーズ１との違いはデータベースのホスト名で Aurora クラスターのライターエンドポイント名を指定している部分です。</p>
<p>・データベース名：wp_database</p>
<p>・ユーザー名：admin</p>
<p>・パスワード：wordpress</p>
<p>・データベースのホスト名：Aurora クラスターのライターエンドポイント名</p>
<p class="image-container"><img style="width: 704.50px" src="img\\d50ae1b5c4e3cc63"></p>
<p>画面が切り替わったら、インストールの実行をクリックしてください</p>
<p class="image-container"><img style="width: 705.50px" src="img\\61d116fbe8bc4510"></p>
<p>以下の画面となりますが、正しい状態です。(Aurora にはすでにデータがインポートされている為)</p>
<p class="image-container"><img style="width: 714.50px" src="img\\953d18e1069446cb"></p>
<p>フェーズ１で設定したブログのユーザ名とパスワードを入力します。</p>
<p class="image-container"><img style="width: 710.50px" src="img\\929195978e723058"></p>
<p>WordPressの管理者画面が表示されます。データベースをRDSに切り替えてもフェーズ１と同様にWordPressが動いていることを確認してください。</p>
<p class="image-container"><img style="width: 710.50px" src="img\\15679705fc8b5429"></p>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ3" duration="0">
        <h2 is-upgraded><strong>フェーズ3 の作成範囲</strong></h2>
<p>フェーズ３ では、新しく以下のリソースを追加します。</p>
<p>・既存の EC2 の AMI を取得します。</p>
<p>・アベイラビリティゾーン C に EC2 を起動します。</p>
<p>・上段に ALB を配置して冗長構成にします。</p>
<p class="image-container"><img style="width: 697.50px" src="img\\264a8c3c2ceca11"></p>
<h2 is-upgraded><strong>フェーズ3：ALB + Web × 2 + DB 構成</strong></h2>
<p>◆拡張性：高</p>
<p>本構成では Web サーバーを自由に増減でき、拡張性が高い構成です。</p>
<p>DB サーバーについては変更がなく、1 台ですのでインスタンスタイプを大きくして拡張することになります。</p>
<p>◆冗長性：中</p>
<p>Web サーバーが複数台稼働している場合に、1 台の Web サーバーに障害が発生してリクエストを返せなくなったとします。すると、アプリケーションロードバランサー (ALB)  は応答が停止した Web サーバー宛てにリクエストを送信しなくなるため可用性が高まります。</p>
<p>DB サーバーはフェーズ`1 / 2 と同じく 1 台構成ですが、Aurora で作成しているので、データ自体の可用性はアベイラビリティゾーンごとにデータクラスターに分散され、担保されています。(Multi-AZ 構成に比べると、冗長性は無い状態です。)</p>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ3：WEB サーバーの AMI 作成" duration="0">
        <h2 is-upgraded><strong>EC2 管理ページを開く</strong></h2>
<p>サービスから [<strong>コンピューティング</strong>] を選択し、[<strong>EC2</strong>] をクリックします。</p>
<p class="image-container"><img style="width: 695.50px" src="img\\13f8f4abe233cb71"></p>
<h2 is-upgraded><strong>WEB サーバの AMI 作成</strong></h2>
<p>EC2 の管理ページにて、左のメニューペインから [インスタンス] をクリックし、インスタンス一覧画面から先の手順で作成したインスタンスを選択します。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\679fd87c3b16f78"></p>
<p>[<strong>アクション</strong>] ボタンから [<strong>イメージとテンプレート</strong>] - [<strong>イメージを作成</strong>] をクリックします。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\cd772982b0024dc2"></p>
<p>イメージの作成画面にて、 handson-ec2-wordpress-image など分かりやすい名前をイメージ名として入力後、[<strong>イメージ</strong>] の作成をクリック</p>
<p class="image-container"><img style="width: 750.00px" src="img\\262ad9276d9a8649"></p>
<p>画面上部に緑の帯でイメージの作成に関するメッセージが表示されますので、「ami-」から始まる AMI イメージ ID をクリックしてください。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\be734d1eee5e9c64"></p>
<p>Amazon マシンイメージ (AMI) の画面で作成を待ちます。</p>
<p>完了するまで数分かかります。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\a44b34b44c330862"></p>
<p class="image-container"><img alt="AWS マネジメントコンソール  リージョン移動 - 東京" style="width: 750.00px" src="img\\39f48ad0d48e1537"></p>
<p>AMI の作成画面で状態が [<strong>保留中</strong>] から [<strong>利用可能</strong>] になることを確認します。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\39e08b096ff82638"></p>
<h2 is-upgraded><strong>2 台目の EC2 インスタンスを作成</strong></h2>
<p>AMI が利用可能になったら選択をして [<strong>AMI からインスタンスを起動</strong>] をクリックしてください。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\251bcc3eb1e0f098"></p>
<h3 is-upgraded>ステップ1: <strong>名前とタグ</strong></h3>
<p><strong>名前 </strong>には、handson-ec2-wordpress-2 と入力してください。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\70dd8ca0a7a2443"></p>
<h3 is-upgraded><strong>ステップ</strong>2<strong>: </strong><strong>インスタンスタイプ</strong></h3>
<p>インスタンスタイプは、 <strong>t2.micro</strong> が選択されていることを確認してください。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\420a7b1d9c92d282"></p>
<h3 is-upgraded>ステップ3: <strong>キーペア (ログイン)</strong></h3>
<p><strong>キーペア名 - 必須</strong> は「キーペアなしで続行 (推奨されません)」を選択してください。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\9978a65c58a5074c"></p>
<h3 is-upgraded><strong>ステップ4: ネットワーク設定</strong></h3>
<p>ネットワーク設定 の右側にある [<strong>編集</strong>] ボタンを押下し、以下の設定をお願いします。</p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>値</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>VPC</p>
</td><td colspan="1" rowspan="1"><p>本日を作成したVPCを設定下さい</p>
<p>手順書通りなら「handson20220425-vpc」となります。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>サブネット</p>
</td><td colspan="1" rowspan="1"><p>*-public2-ap-northeast-1cと記載されたサブネットを設定して下さい</p>
<p>手順書通りなら「handson20220425-public2-ap-northeast-1c」となります。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>パブリックIPの自動割り当て</p>
</td><td colspan="1" rowspan="1"><p>有効化</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>ファイアウォール（セキュリグループ）</p>
</td><td colspan="1" rowspan="1"><p>既存のセキュリティグループを選択する</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>セキュリティグループ名</p>
</td><td colspan="1" rowspan="1"><p>web-sg</p>
</td></tr>
</table>
<p class="image-container"><img style="width: 750.00px" src="img\\dbb86f2db6a85b54"></p>
<h3 is-upgraded><strong>ステップ5: 高度な詳細</strong></h3>
<p>以下の設定をお願いします。</p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>値</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>IAM インスタンスプロフィール</p>
</td><td colspan="1" rowspan="1"><p>本日を作成したRoleを設定下さい</p>
<p>手順書通りなら「handson-ec2-role」となります。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>クレジット仕様</p>
</td><td colspan="1" rowspan="1"><p>スタンダード</p>
<p>（無制限の場合、t 系インスタンスで CPU クレジットが枯渇した際に予想以上のコストがかかる場合があります。）</p>
</td></tr>
</table>
<p class="image-container"><img style="width: 750.00px" src="img\\fd7b956cf17f6cf3"></p>
<p class="image-container"><img style="width: 750.00px" src="img\\61c7f55396f3e6c3"></p>
<p>以上が設定できたら、[<strong>インスタンスを起動</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\bae632eb327a7c0b"></p>
<p>EC2 インスタンスの作成が始まりました。</p>
<p>[<strong>インスタンス一覧を表示</strong>] ボタンをクリックしてください。</p>
<p>インスタンスの一覧画面に遷移するので、2 台のインスタンスが 2 つの異なるアベイラビリティゾーンで起動している事を確認してください。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\34cc3fc09ae12ceb"></p>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ3：ALB を作成" duration="0">
        <h2 is-upgraded><strong>ALB のセキュリティグループ</strong></h2>
<p>以下のように Web サーバのフロントに ALB を作成します。</p>
<p>ALB 用のセキュリティグループは任意の IP アドレスから 80 番ポートへのアクセスを受け付けるように登録します。また、後続の手順で WEB サーバのセキュリティグループは ALB からのみ受け付けるように変更します。</p>
<p class="image-container"><img style="width: 704.48px" src="img\\71e35e2dee294c7c"></p>
<h2 is-upgraded><strong>ALB を作成</strong></h2>
<p>2 台の Web サーバへのアクセスを振り分ける ALB を作成します。</p>
<p>サービスから [<strong>コンピューティング</strong>] を選択し、[<strong>EC2</strong>] をクリックします。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\13f8f4abe233cb71"></p>
<p>EC2 の管理ページに移動したら、左ペインより [<strong>ロードバランサー</strong>] を選択し、[<strong>ロードバランサーの作成</strong>] をクリックします。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\43952093134961e8"></p>
<p>[<strong>ロードバランサーの選択</strong>] 画面に遷移しますので、左側にある [<strong>Application Load Balancer</strong>] の [<strong>作成</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\2942036961087906"></p>
<p>データベースの作成で以下を選択、入力します。[<strong>基本的な設定</strong>] は以下のように設定してください。</p>
<p>・ロードバランサー名：alb-handson</p>
<p>・スキーム：インターネット向け</p>
<p>・IPアドレスタイプ：IPv4</p>
<p class="image-container"><img style="width: 750.00px" src="img\\f10bd004a8844ecb"></p>
<p>[<strong>ネットワークマッピング</strong>] は以下のように設定してください。</p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>値</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>VPC</p>
</td><td colspan="1" rowspan="1"><p>本日を作成したVPCを設定下さい</p>
<p>手順書通りなら「handson20220425-vpc」となります。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>マッピング<br>ap-northeast-1a</p>
</td><td colspan="1" rowspan="1"><p>パブリックサブネットを選択してください。ハンズオンの通りに命名している場合、以下となります。</p>
<p>handson20220425-subnet-public1-ap-northeast-1a</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>マッピング</p>
<p>ap-northeast-1c</p>
</td><td colspan="1" rowspan="1"><p>パブリックサブネットを選択してください。ハンズオンの通りに命名している場合、以下となります。</p>
<p>handson20220425-subnet-public2-ap-northeast-1c</p>
</td></tr>
</table>
<p class="image-container"><img style="width: 750.00px" src="img\\2b6be4200a1d169d"></p>
<h3 is-upgraded><strong>セキュリティグループの設定</strong></h3>
<p>[<strong>新しいセキュリティグループの作成</strong>] をクリックすると、作成ウィザードが別タブで開きます。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\b1eaae3f09a518ec"></p>
<p>[基本的な詳細] は以下のように設定してください。</p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>値</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>セキュリティグループ名</p>
</td><td colspan="1" rowspan="1"><p>alb-sg</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>説明</p>
</td><td colspan="1" rowspan="1"><p>alb-sg</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>VPC</p>
</td><td colspan="1" rowspan="1"><p>フェーズ1 で作成したVPC</p>
<p>ハンズオンの通りに命名している場合、以下となります。</p>
<p>handson20220425-vpc</p>
</td></tr>
</table>
<aside class="special"><p><strong>VPC は × をクリックすると選択できるようになります。</strong></p>
</aside>
<p class="image-container"><img style="width: 750.00px" src="img\\cb561f8de6eeaf73"></p>
<p>[<strong>インバウンドルール</strong>] は [<strong>ルールを追加</strong>] ボタンをクリックして以下のように設定してください。</p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>値</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>タイプ</p>
</td><td colspan="1" rowspan="1"><p>HTTP</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>ソース</p>
</td><td colspan="1" rowspan="1"><p>マイ IP</p>
</td></tr>
</table>
<aside class="special"><p><strong>HTTPS を誤って選択しないよう、ご注意ください。</strong></p>
</aside>
<p class="image-container"><img style="width: 750.00px" src="img\\9ed3a125ef3e88c4"></p>
<p>アウトバウンドルール、タグはデフォルト設定のまま変更しません。</p>
<p>最後に [<strong>セキュリティグループを作成</strong>] をクリックします。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\e580803e38384f12"></p>
<p>セキュリティーグループを作成したら、ロードバランサー作成途中のタブに戻ってください。</p>
<p>下図の更新ボタンをクリックすると、前項で作成したセキュリティグループ「alb-sg」が表示されます。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\90b12f3088ba58f9"></p>
<p>セキュリティグループ [alb-sg] を選択します。</p>
<p>「default」は × をクリックして外します。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\2854f35705711665"></p>
<p>以下の通り「alb-sg」だけが選択されている状態にしてください。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\85d6ffa590983d76"></p>
<h3 is-upgraded><strong>ターゲットグループの作成</strong></h3>
<p>[<strong>リスナーとルーティング</strong>] のセクションで、[<strong>ターゲットグループの作成</strong>] をクリックすると、別タブでターゲットグループの作成ウィザードが別タブで開きます。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\d0357e55056c9187"></p>
<p>別タブでターゲットグループの作成ウィザードが開いたら、[<strong>基本的な設定</strong>] を以下のように設定します。</p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>値</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>ターゲットタイプの選択</p>
</td><td colspan="1" rowspan="1"><p>インスタンス</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>ターゲットグループ名</p>
</td><td colspan="1" rowspan="1"><p>alb-target</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>VPC</p>
</td><td colspan="1" rowspan="1"><p>本日を作成したVPCを設定下さい</p>
<p>手順書通りなら「handson20220425-vpc」となります。</p>
</td></tr>
</table>
<p class="image-container"><img style="width: 750.00px" src="img\\f1e22603319fe9ab"></p>
<p>[<strong>ヘルスチェックの詳細設定</strong>] を展開して、[<strong>正常のしきい値</strong>] を 2 にしてください。</p>
<p>その他の設定はデフォルトのままとしてください。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\ba944492ede5e494"></p>
<p>画面右下の [<strong>次へ</strong>] ボタンをクリックします。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\6bb027d6a8441348"></p>
<h3 is-upgraded><strong>ターゲットの登録</strong></h3>
<p>ALB からのトラフィックを分散する先として、フェーズ2 で作成した EC2 インスタンスの登録を行います。VPC が正しく選択されていれば、作成した EC2 インスタンスが表示されます。</p>
<p>チェックボックスにチェックを入れて、[<strong>保留中として以下を含める</strong>] ボタンをクリックします。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\a67e952f1ed0df9"></p>
<p>ターゲット登録するインスタンスを確認したら [<strong>ターゲットグループの作成</strong>] をクリックします。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\4d0370903aeb47dc"></p>
<p>再びロードバランサーの作成ウィザードのタブに戻ります。</p>
<p>更新ボタンをクリックすると、作成したターゲットグループが表示されるので選択します。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\5c193145f6c11dc"></p>
<p>画面最下部にある [<strong>概要</strong>] 欄にて上記の各設定が正しく設定されているかを確認して、[<strong>ロードバランサーの作成</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\1d71b5b1e5a86b52"></p>
<h2 is-upgraded><strong>WEB サーバのセキュリティグループの編集</strong></h2>
<p>ALB から WEB サーバへ接続する為、既存の WEB サーバのセキュリティグループを編集します。</p>
<p>[<strong>サービス</strong>] をクリックして、[<strong>ネットワーキングとコンテンツ配信</strong>] - [<strong>VPC</strong>] を選択してください。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\457ef2322e72cd09"></p>
<p>左側のメニューペインにある [<strong>セキュリティグループ</strong>] をクリックします。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\1941ddf01c9016d3"></p>
<p>セキュリティグループの一覧が表示されたら、[<strong>web-sg</strong>] を選択します。</p>
<p>下部の詳細ペインに表示された [<strong>インバウンド</strong>] タブをクリックして、[<strong>インバウンドのルールを編集</strong>] ボタンをクリックしてください。</p>
<h2 is-upgraded><img style="width: 750.00px" src="img\\ffd98e4959c1031"></h2>
<p>ソース [<strong>カスタム</strong>] の右側にあるテキストボックスをクリックして、表示された候補から [<strong>alb-sg</strong>] を選択してください。</p>
<p>[<strong>ルールの保存</strong>] をクリックしてください。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\7d93f93da86dabc2"></p>
<p>下記のエラーが起きた場合は、既存のインバウンドルールを一旦削除してから、新たにタイプHTTP、ソースを [<strong>alb-sg</strong>] としてルールを追加してください。</p>
<aside class="warning"><p><strong>※ 下図のエラーが表示された場合はルールを追加 / 削除してください。</strong></p>
</aside>
<p class="image-container"><img style="width: 750.00px" src="img\\6e152a75c688c213"></p>
<p>[<strong>ルールの追加</strong>] ボタンから新しくルールを追加して [<strong>alb-sg</strong>] を指定します。</p>
<p>エラーが表示されたルールは [<strong>削除</strong>] ボタンで削除してください。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\ed60cbbfa2752252"></p>
<h2 is-upgraded><strong>作成した ALB の動作確認</strong></h2>
<p>EC2 の管理ページに戻り、右側のメニューペインにある [<strong>ロードバランサー</strong>] をクリックします。</p>
<p>作成した ALB (手順通りであれば alb-handson になっているはずです) を選択して、詳細ペインに表示された <strong>DNS 名</strong>をメモします。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\62d56a8b1faf937b"></p>
<p>続いて、右側のペインにある [<strong>ターゲットグループ</strong>] をクリックして、作成したターゲットグループ (手順通りであれば alb-target になっているはずです) を選択します。</p>
<p>下部に表示された詳細ペインにある [<strong>ターゲット</strong>] タブをクリックし、ヘルスステータスが [<strong>healthy</strong>] であることを確認してください。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\35a5842ea13bcfb3"></p>
<h2 is-upgraded><strong>WordPress の設定変更</strong></h2>
        <p>WordPress は、初期セットアップでデータベースにパブリック IPv4 アドレスを登録します。<br />
                先ほど初期セットアップをしたときは EC2 にアタッチした Elastic IP アドレスでアクセスしていました。なので、データベースには Elastic IP アドレスが記録されています。</p>
        <p>このデータベースに登録されたアドレスを、ALB の DNS 名に変更する必要があります。</p>
<p>ひとまず、現在の設定を確認してみましょう。<br />
        [<strong>handson-ec2-wordpress</strong>]、[<strong>handson-ec2-wordpress-2</strong>] の 2 つのサーバーのどちらかにセッションマネージャーで接続し、以下のコマンドを実行します。</p>
<aside class="special"><p><strong>endpoint は先ほどメモした Aurora クラスターのライターインスタンスのエンドポイント名部分を入れてください。</strong></p>
</aside>

<pre><code>sh-5.1$ sudo -i

# mysql -u admin -p -h endpoint wp_database
Enter password: wordpress

mysql&gt; select * from wp_options where option_name='siteurl' or option_name='home';
</code></pre>

コマンドを投入すると、以下のように IP アドレスが表示されます。

<pre><code>
+-----------+-------------+---------------------+----------+
| option_id | option_name | option_value        | autoload |
+-----------+-------------+---------------------+----------+
|         2 | home        | http://13.113.94.95 | yes      |
|         1 | siteurl     | http://13.113.94.95 | yes      |
+-----------+-------------+---------------------+----------+
2 rows in set (0.001 sec)

</code></pre>

この IP アドレスを ALB の DNS 名に変更します。
続けて、以下のようにコマンドを投入します。

<aside class="special"><p><strong>"http://DNS名" の部分には先ほどメモした ALB の DNS 名を入れてください。</strong></p>
        </aside>

<pre><code>
MySQL [wp_database]> update wp_options set option_value='http://DNS名' where option_name='siteurl' or option_name='home';
Query OK, 2 rows affected (0.007 sec)
Rows matched: 2  Changed: 2  Warnings: 0

</code></pre>

もう一度、SELECT 文を投入して、Elastic IP アドレスから、ALB の DNS 名に変わったことを確認してみてください。

<pre><code>
MySQL [wp_database]> select * from wp_options where option_name='siteurl' or option_name='home';
+-----------+-------------+---------------------------------------------------------------+----------+
| option_id | option_name | option_value                                                  | autoload |
+-----------+-------------+---------------------------------------------------------------+----------+
|         2 | home        | http://alb-handson-500587210.ap-northeast-1.elb.amazonaws.com | yes      |
|         1 | siteurl     | http://alb-handson-500587210.ap-northeast-1.elb.amazonaws.com | yes      |
+-----------+-------------+---------------------------------------------------------------+----------+
2 rows in set (0.001 sec)

</code></pre>

MySQL を抜けてください。

<pre><code>
mysql&gt; exit;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ3：ALB経由でのアクセス" duration="0">
        <h2 is-upgraded><strong>アクセス確認</strong></h2>
<p>http://&lt;ALB の DNS 名&gt;/ を開いて、WordPressが表示されることを確認します。</p>
<p class="image-container"><img style="width: 700.50px" src="img\\72e7de54e5eb7e79"></p>
<p>http://&lt;EC2サーバr#1,#2のグローバルIP&gt;/ にはアクセスできなくなっている事を確認します。</p>
<p class="image-container"><img style="width: 645.50px" src="img\\290e94fb59cc1ac2"></p>
<h2 is-upgraded>両方のサーバにリクエストがバランシングされるか確認</h2>
<p>WEB サーバー #1、WEBサーバー #2 のそれぞれにセッションマネージャでログインし、以下のコマンドを実行してアクセスログを表示させることが可能です。</p>
<p>ALB の定期的なヘルスチェックが実行されたり、WordPress でページをリロードするたびに双方の EC2 へアクセスされている状況を確認できます。</p>
<pre><code># tail -f /var/log/nginx/access.log | grep -v &#34;ELB-HealthChecker/2.0&#34;

Ctrl + C で終了</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Option：ALB &#43; Web x 2 &#43; DB x 2 構成（サーバ 4 台構成）" duration="0">
        <h2 is-upgraded><strong>【オプションハンズオン】ALB + Web x 2 + DB x 2 構成（サーバ 4 台構成）</strong></h2>
<p><strong>◆拡張性：高</strong></p>
<p>データベースが Multi-AZ 構成になります。Active で動作する DB サーバは変わらず１台ですが、インスタンスタイプの変更時は先にスタンバイ側を変更してからフェイルオーバーする動作になるため変更時の停止時間を短く抑えることができます。</p>
<p><strong>◆冗長性：高</strong></p>
<p>DB サーバがアベイラビリティゾーンにまたがって 2 台構成となり、障害時には自動的にフェイルオーバする構成となり、冗長性が高まります。</p>
<h2 is-upgraded><strong>Option：RDS を Multi-AZ 構成に変更</strong></h2>
<h3 is-upgraded><strong>本フェーズでの作成範囲</strong></h3>
<p class="image-container"><img style="width: 699.50px" src="img\\932a4651ad0bb2e5"></p>
<h2 is-upgraded><strong>Aurora を Multi-AZ 構成に変更する</strong></h2>
<p>[<strong>サービス</strong>] をクリックし、[<strong>データベース</strong>] をクリックして [<strong>RDS</strong>] を選択します。</p>
<p class="image-container"><img style="width: 702.50px" src="img\\880c0a2310dcbc62"></p>
<p>RDS の管理ページに遷移したら、左側のメニューペインにある [<strong>データベース</strong>] をクリックします。</p>
<p>作成したデータベースを選択して、[<strong>アクション</strong>] ボタンから [<strong>リーダーの追加</strong>] ボタンをクリックします。</p>
<p class="image-container"><img style="width: 713.34px" src="img\\f58ca4a3bb2d2b3e"></p>
<p>[<strong>リーダーの追加</strong>] ウィザードに遷移するので、[<strong>DB インスタンス識別子</strong>] を指定します。</p>
<p>ここでは aurora-mysql-db-reader とします。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\3dc8b73bb7642c79"></p>
<p>[<strong>接続</strong>] のセッションまで進み、アベイラビリティゾーンを [<strong>ap-northeast-1c</strong>] に変更します。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\d4f1ead20cb8d4d9"></p>
<p>ページ下部にある [<strong>Add reader</strong>] ボタンをクリックします。</p>
<p class="image-container"><img style="width: 750.00px" src="img\\76e050b37064ca2a"></p>
<p>リーダーインスタンスが追加されるのを待ちます。(約 10 分)</p>
<p class="image-container"><img alt="AWS マネジメントコンソール  リージョン移動 - 東京" style="width: 750.00px" src="img\\39f48ad0d48e1537"></p>
<p>10 分ほど経過すると、対象の Aurora インスタンスが全て [<strong>利用可能</strong>] のステータスに変わります。</p>
<p>リージョンと AZ が a と c に分かれて 2 ゾーンになっていることを確認してください。</p>
<p class="image-container"><img style="width: 712.50px" src="img\\5a74ba83383879c4"></p>
<h2 is-upgraded><strong>Aurora のフェイルオーバーを実施する</strong></h2>
<p>フェイルオーバーする前に事前に各クラスターのIPアドレスを取得し、メモします。</p>
<p class="image-container"><img style="width: 709.29px" src="img\\23efdedb47802db4"></p>
<p>上記のライターインスタンスとリーダーインスタンスのエンドポイントをコピーし、</p>
<p>セッションマネージャーからEC2インスタンスにログインして以下コマンドを実行してください。</p>
<p>ライターインスタンスとリーダーインスタンスの応答されたIPアドレスをメモします。</p>
<pre><code># dig aurora-mysql-db.cluster-cfqns4hpf8id.ap-northeast-1.rds.amazonaws.com
※上記は例の為、自分のライターインスタンスのDNS名でdigを叩いてください

&lt;省略&gt;

aurora-mysql-db-instance-1.cfqns4hpf8id.ap-northeast-1.rds.amazonaws.com. 5 IN A 10.0.2.247


# dig aurora-mysql-db.cluster-ro-cfqns4hpf8id.ap-northeast-1.rds.amazonaws.com
※上記は例の為、自分のリーダーインスタンスのDNS名でdigを叩いてください

&lt;省略&gt;

aurora-mysql-db-reader.cfqns4hpf8id.ap-northeast-1.rds.amazonaws.com. 5 IN A 10.0.3.253
</code></pre>
<p>対象の Aurora のインスタンス側にチェックを入れ、アクションからフェイルオーバーを選択してください。<img style="width: 704.50px" src="img\\80734d545b014f4c"></p>
<p>フェイルオーバーをクリックします。</p>
<p class="image-container"><img style="width: 709.43px" src="img\\306721b967f7754c"></p>
<p>フェイルオーバー実施後、改めてライターインスタンスとリーダーインスタンスのIPアドレスを改めて確認し、フェイルオーバーによってIPアドレスが変更され、インスタンスが移動している事を確認する。</p>
<pre><code># dig aurora-mysql-db.cluster-cfqns4hpf8id.ap-northeast-1.rds.amazonaws.com

&lt;省略&gt;

aurora-mysql-db-instance-1.cfqns4hpf8id.ap-northeast-1.rds.amazonaws.com. 5 IN A 10.0.3.253


# dig 
aurora-mysql-db.cluster-ro-cfqns4hpf8id.ap-northeast-1.rds.amazonaws.com

&lt;省略&gt;

aurora-mysql-db-reader.cfqns4hpf8id.ap-northeast-1.rds.amazonaws.com. 5 IN A 10.0.2.247
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="さらに拡張性を高める" duration="0">
        <p>ハンズオン構築ここまでお疲れ様でした！</p>
<p>ここからは、一旦、WordPress を考慮せずに一般的な更に拡張性を高める方法を解説します。</p>
<h2 is-upgraded>Web サーバーとしての拡張性</h2>
<h3 is-upgraded>▼ Auto Scaling を実装して負荷調整を自動で行う</h3>
<p>Auto Scaling は CPU 負荷やリクエスト数上昇などをトリガーに、需要に合わせてインスタンスを自動で起動したり、削除したりする機能です。</p>
<p>フェーズ2 で作成した Amazon マシンイメージを使って、インスタンスを起動することができます。</p>
<h3 is-upgraded>▼ 静的コンテンツに Amazon S3 の Web サイト希望を使用する</h3>
<p>Amazon S3 はオブジェクトストレージとしてファイルを保存するだけでなく、静的ウェブホスティング html ファイルといった静的コンテンツを使って Web サイトを配信できます。</p>
<p>Amazon S3 は 99.99% の可用性があり、堅牢なサイトを低コストで提供できます。 静的ウェブホスティング は s3 バケットのプロパティにあります。</p>
<p class="image-container"><img style="width: 712.50px" src="img\\ed4bee18952bf80.png"></p>

<h3 is-upgraded>▼ CloudFront でコンテンツをキャッシュする</h3>
<p>CloudFront は Web サーバーの前段でコンテンツをキャッシュする CDN (コンテンツデリバリーネットワーク) サービスです。</p>
<p>世界中にある Amazon の Edge サーバーにてコンテンツをキャッシュするので、高速で安全なウェブサイトを提供できます。</p>
<p>ALB の前段に配置することで、ALB と EC2 へのアクセス負荷を軽減することができますし、ALB や EC2 に直接アクセスするルートを遮断して、CloudFront からの経路に限定することでオリジンコンテンツを保護できます。</p>
<p class="image-container"><img style="width: 712.50px" src="img\\9fa026ef00ddab0b.png"></p>
      </google-codelab-step>
    
      <google-codelab-step label="さらに安全性を高める" duration="0">
        <h2 is-upgraded>データベース接続に <strong>IAM 認証を利用する</strong></h2>
<h2 is-upgraded><strong>監視を行う</strong></h2>
<h3 is-upgraded><strong>CloudWatchで監視</strong></h3>
<h3 is-upgraded><strong>サードパーティ製品・サービスで監視</strong></h3>
<h2 is-upgraded>CloudTrail で監査ログを残す</h2>


      </google-codelab-step>
    
      <google-codelab-step label="WordPress を実際に複数台で構成する場合の留意点" duration="0">
        <p>本ハンズオンで構築したアーキテクチャでは、複数台構成の WordPress を適切に使用できない点があります。</p>
<h2 is-upgraded>アップロードしたファイルの表示</h2>
<p>アップロードされたメディアファイルは各サーバのローカルに保存されます。</p>
<p>例えば、以下の図のようにユーザーがクライアント PC から写真をアップロードしたとします。このとき、1 台の WordPress サーバーにデータをアップロードされますが、もう一台の WordPress サーバーには写真がない状態になります。</p>
<p>この状態でクライアント PC からブラウザでページにアクセスすると、画像が表示されたり、されなかったりといった不具合が起きます。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\ce0f38ca2a6a26a3"></p>
<p>解決法としては以下が挙げられます。</p>
<ol type="1" start="1">
<li>WordPress のプラグインを利用する<br>「Amazon S3 and Cloudfront」などの WordPress プラグインを使って、メディアファイルを S3 に保管するような仕組みを導入します。</li>
<li>EFS を利用する<br>Amazon EFS を利用して、各サーバで共有ストレージとしてマウントします。<br>この方法は読み込みのオーバーヘッドが発生するため、キャッシュ設定を考慮する必要があります。<br><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\fd8fb4359898ef83"></li>
<li>EBS 間で rsync を実装する<br>EC2 サーバーで rsync を設定して、別サーバーにデータを送信するようにします。<br>この場合は、データが削除された場合の考慮が必要です。 <img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\a53d5802ea236bf0"></li>
</ol>
<h2 is-upgraded>サーバー間のアップグレードが同期できない</h2>
<p>各サーバーの WordPress 管理画面からプラグイン、テーマのバージョンアップや変更を行えますが、変更内容が各サーバーのローカルディスク上に反映されて、そのサーバー以外の全サーバーに適用されない課題があります。解決方法としては、以下が挙げられます。</p>
<ol type="1" start="1">
<li>Web サーバ間のローカルディスクを同期する仕組みを実装する<br>例えば、管理機能部分を特定の Web サーバー 1 台に Proxy して、rsyncd + lsyncd で残りのサーバーに配布する方法が考えられます。<br>ALB のルールで 管理画面の URL パス (/wp-admin/*) が含まれた場合はマスターサーバーにルーティングする。といった実装も可能です。<br><img alt="AWS マネジメントコンソール サインイン画面" style="width: 750.00px" src="img\\3cf26fc5455bb77e"></li>
<li>変更したプログラム・コンテンツをイメージとして別途作成してデプロイする方式にする<br>ゴールデンイメージを作成して、展開する方法です。手間ですが、Auto Scaling を実装する場合は有効です。</li>
<li>Amazon EFS を利用して、各サーバで共有ストレージをマウントする<br>こちらも読み込みのオーバーヘッドを考慮して、キャッシュ設定を考慮する必要があります。</li>
</ol>
<h2 is-upgraded>WordPress の cron 機能が全体で実行されてしまう</h2>


      </google-codelab-step>
    
      <google-codelab-step label="環境の削除" duration="0">
        <p>ハンズオンで作成したリソースを以下の手順で削除します。そのままにしておくと<strong>課金が発生する</strong>ものがあるため確実に作業を実施してください</p>
<h2 is-upgraded><strong>EC2 の管理ページから</strong></h2>
<ol type="1" start="1">
<li>左ペインよりロードバランサーの管理ページに移動。作成したロードバランサー(alb-handson) を右クリック → 「削除」</li>
<li>同様にターゲットグループの管理ページに移動。作成したターゲットグループ(alb-target) にチェックを入れて、「アクション」 →「削除」</li>
<li>左ペインよりインスタンスの管理ページに移動。作成したインスタンス(handson-ec2-wordpress-1、handson-ec2-wordpress-2) にチェックを入れる。「インスタンスの状態」→「インスタンスを終了」</li>
<li>「インスタンスの状態」が「terminated」になっていることを確認。</li>
<li>左ペインより Elastic IP に移動。使用していた IP アドレス (handson-ec2-wordpress-1) にチェックを入れて [<strong>アクション</strong>] ボタンから [<strong>Elastic IPアドレスの関連付けの解除</strong>]<br>※ Elastic IP アドレスの関連付けを解除できませんでした。が表示された場合は、既に関連付けが解除されています。画面を更新して [<strong>Elastic IP アドレスの解放</strong>] を選択してください。</li>
<li>左ペインより AMI に移動。作成した AMI (handson-ec2-wordpress-image) にチェックを入れて [<strong>アクション</strong>] ボタンから [<strong>AMI を登録解除</strong>] を実施</li>
<li>左ペインより [<strong>Elastic Block Store]</strong> の下部にある [<strong>スナップショット</strong>] を選択して移動。作成したスナップショットにチェックを入れて [<strong>アクション</strong>] ボタンから [<strong>スナップショットの削除</strong>] を実施</li>
</ol>
<h2 is-upgraded><strong>RDS の管理ページから</strong></h2>
<ol type="1" start="1">
<li>左ペインのデータベースを選び、リーダインスタンス (aurora-mysql-db-instance-1) にチェックを入れて [<strong>アクション</strong>] ボタンから [<strong>削除</strong>] を選択します。本当に削除して良いか確認のため、入力ボックスに、delete me と入力します。(削除は 5 分程度かかります)</li>
<li>ライターインスタンス (aurora-mysql-db-reader) にチェックを入れて、アクションから削除を選択します。バックアップのため、「最終スナップショットを作成しますか?」と表示されますが、今回は不要なのでチェックボックスを外し、「インスタンスの削除後、システムスナップショットとポイントインタイムの復元を含む自動バックアップが利用不可となることを了承しました。」のチェックにチェックを入れて、テキストボックスには delete me と入力して [<strong>削除</strong>] ボタンをクリック。</li>
<li>ライターインスタンスとリーダーインスタンスが削除されると、リージョン別クラスターも自動で削除が実行されます。</li>
<li>完全に削除が完了すると以下のような表記になります。課金を避けるためにも必ず時間をおいて全ての DB 識別子が削除されていることを確認しましょう。<br></li>
</ol>
<p class="image-container"><img style="width: 750.00px" src="img\\9fb93bb024d5ce1d"></p>
<ol type="1" start="5">
<li>左ペインのサブネットグループを選び、当ハンズオンで作成した「db-subnet」にチェックを入れて [<strong>削除</strong>]ボタン を選択します。本当に削除して良いかの確認が出ますので、再度 [<strong>削除</strong>]ボタン を選択します</li>
</ol>
<p class="image-container"><img style="width: 750.00px" src="img\\76f37ac94743df9e"></p>
<h2 is-upgraded><strong>IAM 管理ページから</strong></h2>
<p>(課金対象ではないので、リソースを再利用したい方は実施しなくても問題ありません)</p>
<ol type="1" start="1">
<li>左ペインより [<strong>ロール</strong>] を選択します。</li>
<li>検索ボックスにフェーズ1で作成したロール名 handson-ec2-role を入力します。</li>
<li>チェックボックスにチェックを入れて削除をクリックします。</li>
<li>削除を確認するモーダルが開きますので、ロール名を再び入力</li>
</ol>
<p class="image-container"><img style="width: 750.00px" src="img\\ebd4b2f65b1f1e7b"></p>
<h2 is-upgraded><strong>VPCコンソールから</strong></h2>
<p>(課金対象ではないので、リソースを再利用したい方は実施しなくても問題ありません)</p>
<ol type="1" start="1">
<li>左ペインより [<strong>VPC</strong>] を選択します。</li>
<li>作成した VPC を選択して、[<strong>アクション</strong>] から [<strong>VPCの削除</strong>] を選択します。</li>
<li>VPC 内にあるセキュリティグループ、サブネット、ルートテーブル、インターゲットウェイが同時削除対象として表示されます。</li>
<li>削除して問題なければ入力ボックスに [<strong>削除</strong>] と入力してから右下の [<strong>削除</strong>] をクリックして実行してください。</li>
</ol>
<p class="image-container"><img style="width: 750.00px" src="img\\58d01d326e9baedc"></p>


      </google-codelab-step>
    
      <google-codelab-step label="補足 - MySQL の root パスワードを忘れた場合の復旧方法" duration="0">
        <p>MariaDB の root パスワードを忘れた場合は、以下の手順で root パスワードを更新できます。</p>
<h2 is-upgraded><strong>MariaDB が稼働しているサーバーにログインします。</strong></h2>
<h2 is-upgraded><strong>以下の手順を実行します。</strong></h2>
<h2 is-upgraded><strong>MariaDB をセーフモードで起動します。</strong></h2>
<pre><code>$ sudo service mysqld stop
$ mysqld_safe --skip-grant-tables &amp;</code></pre>
<h2 is-upgraded><strong>MySQL に接続して、root のパスワードを変更します。</strong></h2>
<pre><code>$ mysql -u root
mysql&gt; use mysql;
mysql&gt; update user set password=PASSWORD(&#34;ここに新しいパスワードを指定&#34;) where User=&#39;root&#39;; mysql&gt; commit;
mysql&gt; flush privileges;
mysql&gt; ¥q</code></pre>
<h2 is-upgraded><strong>MariaDB を再起動します。</strong></h2>
<pre><code>$ sudo systemctl stop mariadb
$ sudo systemctl start mariadb</code></pre>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
