
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>AWS 体験ハンズオン〜セキュア&amp;スケーラブルウェブサービス構築</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="awshandson20220329"
                  title="AWS 体験ハンズオン〜セキュア&amp;スケーラブルウェブサービス構築"
                  environment="web"
                  feedback-link="https://github.com/otanikohei/Amazon-VPC—Amazon-EC2—Amazon-RDS-Handson">
    
      <google-codelab-step label="はじめに" duration="2">
        <p class="image-container"><img alt="タイトル画像" src="img/f755787aade4c158.gif"></p>
<p>Amazon Web Services (AWS) を利用して、セキュアでスケーラブルなウェブサービスの構築手順を体験できるハンズオンを実施いたします。<br> AWS を使ってより安全にサービスを運用する方法、ウェブサービスの規模に合わせて、柔軟にシステムを拡張する方法を体験できる内容です。</p>
<aside class="warning"><p> 本ハンズオンのドキュメントで掲載されているスクリーンキャプチャは 2022年04月時点のもので、現在の画面とは異なる場合がございます。予めご了承ください。 </p>
</aside>
<h2 is-upgraded>準備事項</h2>
<h3 is-upgraded>インターネットに接続可能な PC</h3>
<p><img alt="PC イメージアイコン" src="img/8a18f727de870aa1.png"><br> AWS を利用するにはインターネット接続が必要です。Windows、mac、Linux をご準備ください。本ハンズオン資料は mac にて作成しています。</p>
<h3 is-upgraded>AWS アカウント</h3>
<p><img alt="AWS アイコン" src="img/a06b78e541fcc9f.png"> AWS アカウントを事前にご準備ください。</p>
<h3 is-upgraded>ブラウザ</h3>
<p><img alt="ブラウザ イメージアイコン" src="img/67c5707b04520011.png"> Firefox もしくは Google Chrome を推奨します。本ハンズオン資料は Google Chrome にて検証しています。</p>


      </google-codelab-step>
    
      <google-codelab-step label="座学 - セキュリティグループ" duration="2">
        <p><strong>AWS のセキュリティやスケーラビリティを 高める機能・サービス 1/6</strong><img alt="Firewall イメージアイコン" src="img/e251e418ca5598ae.png"> インターネットからのトラフィック (インバウンド) をブロックするだけでなく、EC2 からのトラフィック (アウトバウンド) も制限できるファイアウォール機能です。 <img alt="セキュリティグループイメージ画像" src="img/ab5306a2cf09b4fa.png"> 個々のインスタンスごとに、インバウンド、アウトバウンドに対して下記の許可ルールを定義できます。ルールは <strong>ステートフル</strong> で扱われ、明示ルールが無い通信は拒否されます。</p>
<p><strong>インバウンド</strong></p>
<ul>
<li>プロトコル (TCP/UDP/ICMP)</li>
<li>ポート範囲 (ポート番号の範囲)</li>
<li>送信元 (アクセス元のIPアドレス)</li>
</ul>
<p><strong>アウトバウンド</strong></p>
<ul>
<li>プロトコル (TCP/UDP/ICMP)</li>
<li>ポート範囲 (ポート番号の範囲)</li>
<li>送信先 (アクセス先のIPアドレス)</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="座学 - Amazon VPC (Virtual Private Cloud)" duration="2">
        <p><strong>AWS のセキュリティやスケーラビリティを 高める機能・サービス 2/6</strong><img alt="VPC のアイコン" src="img/3a54948ea72e5cb9.png"> VPC はプライベートな仮想ネットワークサービスです。VPC  を使うと AWS クラウド内にお客様専用のプライベートアドレスの空間を構築できます。<br> 社内ネットワークとインターネット VPN やキャリアの閉域網で接続ができます。</p>
<p class="image-container"><img alt="VPC のイメージ画像" src="img/40519e92608d46d4.png"></p>
<h2 is-upgraded>VPCとサブネットについて</h2>
<ul>
<li>1 つの VPC は、1 つのネットワークアドレス (CIDR) で定義します。</li>
<li>1 つの VPC 内には、複数のサブネットを作成することができます。</li>
<li>サブネットは特定のアベイラビリティーゾーン内に配置します。</li>
</ul>
<p class="image-container"><img alt="VPC とサブネットのイメージ画像" src="img/1dd5c3c8310c0881.png"></p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>CIDR</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>IP アドレス数</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>xxx.xxx.xxx.xxx/16</p>
</td><td colspan="1" rowspan="1"><p>65,531</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>xxx.xxx.xxx.xxx/20</p>
</td><td colspan="1" rowspan="1"><p>4,091</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>xxx.xxx.xxx.xxx/24</p>
</td><td colspan="1" rowspan="1"><p>251</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>xxx.xxx.xxx.xxx/28</p>
</td><td colspan="1" rowspan="1"><p>11</p>
</td></tr>
</table>
<p>上記は払い出される IP アドレス数から、AWS の予約 IP 数を抜いた「ユーザーが利用できる IP 数」です。<br> 各サブネットにおいて先頭の 4 IP アドレスと最後の 1 IP アドレスは AWS 側で確保されます</p>
<ul>
<li>AWS &gt; ドキュメント &gt; Amazon VPC &gt; ユーザーガイド &gt; VPC とサブネットの概要 - <a href="https://docs.aws.amazon.com/ja_jp/vpc/latest/userguide/VPC_Subnets.html#VPC_Sizing" target="_blank">IPv4 用の VPC とサブネットのサイズ設定</a></li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="座学 - ルートテーブル" duration="1">
        <p><strong>AWS のセキュリティやスケーラビリティを 高める機能・サービス 3/6</strong><img alt="ルートテーブルのアイコン" src="img/7f8506b356d8a160.png"></p>
<p>各サブネットにはルートテーブルがアタッチされます。<br> ルートテーブルの設定を変更することでデータの流れを制御できます。</p>
<h2 is-upgraded>パブリックサブネット</h2>
<p>ルートテーブル: rtb-XXXXXXXX</p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>送信先</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>ターゲット</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>10.0.0.0/16</p>
</td><td colspan="1" rowspan="1"><p>local</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>0.0.0.0/0</p>
</td><td colspan="1" rowspan="1"><p>igw-XXXXXXXX</p>
</td></tr>
</table>
<aside class="special"><p> ルーティングテーブルに IGW (インターネット ゲートウェイ) へのルーティングを設定すると、外部とのアクセスが可能になります。 </p>
</aside>
<h2 is-upgraded>プライベートサブネット</h2>
<p>ルートテーブル: rtb-XXXXXXXX</p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>送信先</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>ターゲット</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>10.0.0.0/16</p>
</td><td colspan="1" rowspan="1"><p>local</p>
</td></tr>
</table>
<p class="image-container"><img alt="ルートテーブルのイメージ画像" src="img/eb1de3cde87262e9.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="座学 - NACL (Network Access Control List)" duration="1">
        <p><strong>AWS のセキュリティやスケーラビリティを 高める機能・サービス 4/6</strong><img alt="NACL のアイコン" src="img/33455e4245ef96fc.png"></p>
<aside class="special"><p> 本日のハンズオンでは、NACL は使いません。 </p>
</aside>
<p>制御可能な項目はセキュリティーグループと同じで、ステートフル (SG) かステートレス (NACL) かの違いがあります。</p>
<p class="image-container"><img alt="セキュリティグループと NACL のイメージ画像" src="img/18fe3e06a186e2b5.png"></p>
<h2 is-upgraded>Network Access Control List</h2>
<ul>
<li>個々のサブネットごとにアクセス制御が可能</li>
<li>インバウンド、アウトバウンドに対して下記の設定が可能</li>
</ul>
<h2 is-upgraded>インバウンド</h2>
<ul>
<li>Port range (ポート番号)</li>
<li>Source (アクセス元 IP アドレス)</li>
<li>Allow/Deny</li>
</ul>
<h2 is-upgraded>アウトバウンド</h2>
<ul>
<li>Port range (ポート番号)</li>
<li>Destination (アクセス先 IP アドレス)</li>
<li>Allow/Deny</li>
</ul>
<p>制御可能な項目はセキュリティグループと同じです。<br> セキュリティグループは、ステートフルで動作し、NACL はステートレスで動作します。</p>


      </google-codelab-step>
    
      <google-codelab-step label="座学 - AWS IAM" duration="1">
        <p><strong>AWS のセキュリティやスケーラビリティを 高める機能・サービス 5/6</strong></p>
<p class="image-container"><img alt="IAM のアイコン" src="img/52a5b64cfe33128c.png"></p>
<p>AWS 自体のリソース操作をよりセキュアに行うための認証・認可の仕組みです。<br> AWS 利用者の認証とアクセスポリシーを「グループ」「ユーザー」「ロール」で管理します。</p>
<ul>
<li>実行出来る操作を IAM ポリシーで設定</li>
<li>ユーザーごとに認証情報の設定が可能</li>
<li>マネージメントコンソールにはユーザ名とパスワードを使用 さらに、MFA (多要素認証) の利用が推奨</li>
<li>API にはアクセスキーとシークレットキーを使用</li>
</ul>
<h2 is-upgraded>IAM ポリシーで必要最小限のみ付与</h2>
<p class="image-container"><img alt="IAM のイメージ画像" src="img/d67cdb514107ddc3.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="座学 - 備考 - MFA (多要素認証) で認証の安全性を高める" duration="1">
        <p><strong>AWS のセキュリティやスケーラビリティを 高める機能・サービス 6/6</strong></p>
<h2 is-upgraded>AWS アカウント (ルートアカウント) の保護</h2>
<p>AWS アカウント (ルートアカウント) は、ハードウェアトークンで保護することが推奨されています。<br> また、ハードウェアトークンは金庫などで管理することが推奨されています。</p>
<p class="image-container"><img alt="IAM のアイコン" src="img/42bf5ecb502dd20b.jpg"></p>
<h2 is-upgraded>IAM アカウントの保護</h2>
<p>IAM アカウントは、個人で利用するアカウントです。<br> こちらは、仮想 MFA 対応のスマホアプリにて保護すると効率的にご利用いただけます。</p>
<p class="image-container"><img alt="IAM のアイコン" src="img/997264992b77e6ea.jpg"></p>
<p>MFA (多要素認証) を設定すると、AWS アカウントサインイン時に <strong>6 桁</strong> のコードを求められるようになります。</p>
<p class="image-container"><img alt="IAM のアイコン" src="img/b4f8900749472245.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="ハンズオン" duration="1">
        <h2 is-upgraded>ハンズオンの流れ</h2>
<h3 is-upgraded>フェーズ 1</h3>
<p>WordPress サイトを最小構成でスタートする。</p>
<ul>
<li>サーバー 1 台構成</li>
</ul>
<p class="image-container"><img alt="Phase1 完成図" src="img/59c47d2b8093890e.png"></p>
<h3 is-upgraded>フェーズ  2</h3>
<p>スケールできるアーキテクチャに移行する準備をする。</p>
<ul>
<li>Web + DB (サーバー 2 台構成)</li>
</ul>
<p class="image-container"><img alt="Phase2 完成図" src="img/5f779975236e979.png"></p>
<h3 is-upgraded>フェーズ 3</h3>
<p>Web サーバーがスケールできる構成にする。</p>
<ul>
<li>LB + Web x 2 + DB (サーバー 3 台構成)</li>
</ul>
<p class="image-container"><img alt="Phase3 完成図" src="img/f54bdbcea826b4a8.png"></p>
<h3 is-upgraded>オプション</h3>
<p>DB サーバーを冗長化された構成にする。</p>
<ul>
<li>LB + Web x 2 + DB x 2 (サーバー 4 台構成)</li>
</ul>
<p class="image-container"><img alt="Phase オプション完成図" src="img/5108246d98864acd.png"></p>
<h3 is-upgraded>最終</h3>
<p>DB サーバーを冗長化された構成にする。</p>
<ul>
<li>LB + Web x 2 + DB x 2 (サーバー 4 台構成)</li>
</ul>
<p class="image-container"><img alt="最終構成図" src="img/31a41ae7ef24c7e8.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="無料利用枠について" duration="0">
        <p>【補足】無料利用枠 (個人アカウントでご参加の方向け)</p>
<aside class="warning"><p> 注意: IAM ユーザーではなく、個人のアカウントでご参加されている方への補足 </p>
</aside>
<p>ハンズオンの一部は AWS 無料利用枠の範囲で進めることができます。また、ハンズオンが終了した後で、作成したリソースを全て削除すると課金はされません。</p>
<h2 is-upgraded>&lt;1年間、以下範囲が毎月無料で利用できます&gt;</h2>
<ul>
<li>EC2: Windows/Linux/RedHat など の t2.micro インスタンスを合計約 1ヶ月分</li>
<li>EBS: 合計 30GB の General Purpose (SSD) と 1GB のスナップショットを合計約 1ヶ月分</li>
<li>RDS: MySQL/PostgreSQL など を 20GB まで db.t2.micro インスタンスを合計約 1ヶ月分 (シングルAZ構成限定)</li>
<li>ELB: 合計約 1ヶ月分、15GB の処理 トラフィック:インターネットへのデータ送信 15GB</li>
</ul>
<p><a href="https://aws.amazon.com/jp/free/" target="_blank">AWS 無料利用枠</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="始める前に" duration="2">
        <h2 is-upgraded>スクリーンキャプチャに表示されている情報について</h2>
<p>リソースの各種 ID (vpc-XXXXXX、subnet-XXXXXX、i-XXXXXX など) は AWS 全体で ユニークとなっており、スクリーンキャプチャに記載の ID と実際に操作されて作成される ID は各自で異なります。<br> Elastic IP (固定IPアドレス) なども各自で異なります。<br> 画面のデザイン等が変更されて実際とは異なっていることがあります。画面の項目名等から判断して操作下さい。</p>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ1　- サインイン" duration="2">
        <h2 is-upgraded>サーバー 1 台構成</h2>
<p>最小構成で最も低コストですが、拡張性が低く、性能を一定以上上げることができません。</p>
<p class="image-container"><img alt="Phase1 完成図" src="img/59c47d2b8093890e.png"></p>
<h3 is-upgraded>拡張性: 低</h3>
<p>拡張するには 1 台のインスタンスタイプを大きくします。</p>
<h3 is-upgraded>冗長性: 低</h3>
<p>インスタンスが稼働する物理サーバが壊れると一旦停止になりますが、同じアベイラビリティーゾーン内の問題の無いサーバですぐ起動できます。</p>
<h2 is-upgraded>AWSマネジメントコンソールへのログイン</h2>
<p>ログイン方法は利用するアカウント種類によって異なります。</p>
<h4 is-upgraded>IAM アカウントをご利用の場合</h4>
<aside class="special"><p> 通常はこちらです。 </p>
</aside>
<h4 is-upgraded>会社等で、IAM アカウントを本ハンズオン用に準備されているケース</h4>
<p>事前にログイン情報が記載された csv ファイル (user1.csv 等) を確認してください。そのファイルに、ログイン用の URL、User Name、パスワードが記載されていますので、 それに従ってログインしてください。</p>
<h4 is-upgraded>AWS のルートアカウント(個人アカウント)をご利用の場合</h4>
<p><a href="https://console.aws.amazon.com" target="_blank">https://console.aws.amazon.com</a> にブラウザでアクセスして、アカウントの E メールアドレスとパスワードでログインしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/a4dc7a53baf24c00.png"></p>
<p>サインインするとホーム画面が表示されます。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール ホーム画面" src="img/360b910866c6647b.png"></p>
<p>左上の AWS アイコンをクリックするとホームに戻ります。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール ホーム画面 - ホーム" src="img/d492d116952953d4.png"></p>
<p>サービスをクリックすると、EC2 や RDS といった各種 AWS サービス名へのリンクにアクセスできます。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール ホーム画面 - サービス" src="img/4415c30de8e351ca.png"></p>
<p>テキストボックスにサービス名を入力することで候補が表示されるので便利です。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール ホーム画面 - テキスト検索ボックス" src="img/863b1ad0ced8d09b.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ1　- リージョンを変更" duration="2">
        <h2 is-upgraded>リージョンを変更する (シンガポール)</h2>
<p>AWS マネジメントコンソールに初めてサインインすると、「<strong>バージニア北部</strong>」リージョンが表示されます。練習で、シンガポールリージョンに移動してみたいと思います。<br> このリージョン名をクリックして候補から、<strong>アジアパシフィック (シンガポール) ap-southeast-1</strong> を選択してください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール リージョン移動 - シンガポール" src="img/565e22e02420af65.png"></p>
<h2 is-upgraded>リージョンを変更する (シドニー)</h2>
<p>画面遷移して「<strong>シンガポール</strong>」リージョンが表示されたら、次は「<strong>シドニー</strong>」リージョンに移動してみてください。「<strong>シンガポール</strong>」をクリックし、「<strong>アジアパシフィック (シドニー) ap-southeast-2</strong>」を選択してください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール リージョン移動 - シドニー" src="img/3b1bd16d070886df.png"></p>
<h2 is-upgraded>リージョンを変更する (東京)</h2>
<p>リージョンの移動は完璧でしょうか。<br> それでは、本日構築する「<strong>東京</strong>」リージョンに移動してください。「<strong>シドニー</strong>」をクリックし、「<strong>アジアパシフィック (東京) ap-northeast-1</strong>」を選択してください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール  リージョン移動 - 東京" src="img/3089ed7774828837.png"></p>
<h2 is-upgraded>デフォルトリージョンを設定する</h2>
<p>AWS マネジメントコンソールは「<strong>最後に利用したリージョン</strong>」を表示するようになっています。<br> これを変更するには、[<strong>設定</strong>] を開き、<strong>デフォルトリージョン</strong> の「<strong>最後に使用したリージョン</strong>」から希望のリージョンに変更してください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール  リージョン移動 - 東京" src="img/51d0e2b20f88baf6.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ1　- VPC" duration="2">
        <h2 is-upgraded>VPC コンソールにアクセス</h2>
<p>左上の <strong>サービス</strong> をクリックして、表示されたメニューから <strong>ネットワーキングとコンテンツ配信</strong> をクリック、表示された <strong>VPC</strong> を選択します。</p>
<p>VPC コンソールに画面遷移します。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/366e3a210703c49b.png"></p>
<h2 is-upgraded>VPC ウィザードで VPC コンポーネントを作成する</h2>
<p>VPC コンソールが表示されたら、[VPC ウィザードを起動] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/f89e2003ff5312eb.png"></p>
<h3 is-upgraded>VPC ウィザード - 全貌</h3>
<p>VPC ウィザードは文字通り、画面の手順に沿ってクリックして進めていくと VPC が構築できる便利なウィザード機能です。<br> 以前は画面が遷移していく形でしたが、2022年4月現在はリニューアルして 1 ページで収まらないほど大きな画面になりました。全貌は以下の画像の通りですが、順番に設定していきます。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/60165b219bb29bba.png"></p>
<p>まず <strong>作成するリソース</strong> は「VPC、サブネットなど」を選択します。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/2a7d7f7d32b93ed5.png"></p>
<h3 is-upgraded>VPC ウィザード - 名前タグ</h3>
<p>次に、名前タグを設定します。「handsonyyyymmdd(今日の日付)」などの名前を入力してみてください。<br> 右側に表示された VPC やサブネット、ルートテーブル、インターネットゲートウェイ、エンドポイントなどの名前タグが動的に設定されます。<br> 以前のウィザードでは手入力だったので便利になりました。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/8f88d3ab5bfccdea.png"></p>
<h3 is-upgraded>VPC ウィザード - IPv4 CIDR ブロック</h3>
<p>本ハンズオンで作成する VPC のレンジは 10.0.0.0/16 にしますので、</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/2ae0a0d48b76f53d.png"></p>
<p>デフォルトで入力されている「10.0.0.0/16」のまま、次に進んでください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/9a9386f6efe57a26.png"></p>
<h3 is-upgraded>VPC ウィザード - アベイラビリティーゾーン</h3>
<p>アベイラビリティーゾーンは <strong>2</strong> のままで大丈夫です。AZ のカスタマイズから、どのアベイラビリティーゾーンを利用するか決めることができます。本ハンズオンでは、AZ-a と AZ-c を利用します。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/98f6b161179c37f8.png"></p>
<p>本ハンズオンでは、パブリックサブネットを二つ作ります。<br> それぞれ、10.0.0.0/24、10.0.1.0/24 のアドレス空間を利用しますので、</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/46201651d7f0cc65.png"></p>
<p>ap-northeast-1a の IP アドレスを「10.0.0.0/24」に、ap-northeast-1c の IP アドレスを「10.0.1.0/24」と入力してください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/a8707e548ec6f1ae.png"></p>
<p>続いて、プライベートサブネットの IP アドレスも二つ作ります。<br> それぞれ、10.0.2.0/24、10.0.1.3/24 のアドレス空間を利用しますので、</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/a5196b73f373ed6b.png"></p>
<p>ap-northeast-1a の IP アドレスを「10.0.2.0/24」に、ap-northeast-1c の IP アドレスを「10.0.3.0/24」と入力してください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/c65095181c7516b9.png"></p>
<h3 is-upgraded>VPC ウィザード - NAT ゲートウェイ、VPC エンドポイント</h3>
<p>NAT ゲートウェイは利用しません。<br> VPC エンドポイントも今回は利用しないので <strong>なし</strong> にしてください。<br> DNS オプションはどちらもチェックを入れてください。<br> [VPC を作成] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/ca25ed25f658b57f.png"></p>
<p>プレビューにも表示されている通り VPC、サブネット、ルートテーブル、インターネットゲートウェイが作成されます。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/7a7b3986441c0990.png"></p>
<p>VPC が作成されたら [VPC を表示] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/9f19aa9b2622a031.png"></p>
<h3 is-upgraded>ウィザードで作成された　VPC を確認</h3>
<aside class="special"><p> 操作する VPC をフィルタリングしておくことで、他の VPC を操作する間違いを防ぐことができます。 </p>
</aside>
<p>[VPC を表示] ボタンをクリックすると、作成された VPC の詳細画面に遷移するので、左のメニューペインににある <strong>VPC</strong> のリンクをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/c062c8c5e85c9f3f.png"></p>
<p>左のメニューペインににある <strong>VPC でフィルタリング:</strong> のテキストボックスをクリックすると、候補が表示されますので、作成した VPC を選択してください。</p>
<aside class="warning"><p> 既存のVPC と間違わないように注意:  VPC 作成後は表示されないケースもあるので、[F5] キーで画面更新していただくか、自分の VPC が特定できれば作業を割愛して OK です。 </p>
</aside>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/6d45a800474a3122.png"></p>
<p>作成した VPC だけがフィルタリングされて表示されます。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/4c81036370f58598.png"></p>
<aside class="special"><p> メニューペインとの境界線にある ◀︎ アイコンをクリックすると、メニューペインを非表示にして操作画面を大きく表示できます。▶︎ アイコンをクリックすると、メニューペインを再表示できます。 </p>
</aside>
<p> 先ほど作成した VPC が存在するか (正しく絞り込めているか) を確認してください。   この VPC の IPv4 CIDR が 10.0.0.0/16 であることを確認してください。 </p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/a809eef72bd67a75.png"></p>
<h3 is-upgraded>ウィザードで作成されたサブネットを確認</h3>
<p>左のメニューペインにあるサブネットをクリックします。<br> サブネット一覧が表示されますので、AZ-a の名前が記載されたリソースにチェックを入れてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/9e3cc576f4f4d0b1.png"></p>
<p>ページ下部のペインに詳細が表示されますので、アベイラビリティゾーンが ap-northeast-1a であること、IPv4 CIDR が 10.0.0.0/24 であることを確認してください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/7c4f169850c53c58.png"></p>
<h3 is-upgraded>ウィザードで作成されたルートテーブルを確認</h3>
<p>詳細ペインで、<strong>ルートテーブル</strong> のタブをクリックしてください。<br> VPC のネットワークアドレス 10.0.0.0/16 のターゲットが local に、 デフォルトルートの 0.0.0.0/0 のターゲットがインターネットゲートウェイ (igw-XXXX) になっており、インターネットと通信できる設定になっています。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/6871c5e065c7dff9.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ1 - セッションマネージャー" duration="0">
        <h2 is-upgraded>IAM ロールを作成する</h2>
<p>EC2 インスタンスには、Linux OS の場合は SSH で、Windows OS の場合は RDP で接続しますが、本ハンズオンでは SSH ポートを開放せずに AWS Systems Manager のセッションマネージャー経由で接続をします。</p>
<aside class="special"><p> セッションマネージャーを利用するには、IAM ロールが必要です。   </p>
</aside>
<p><strong>サービス</strong> から、<strong>セキュリティ、ID、およびコンプライアンス</strong> をクリックし、<strong>IAM</strong> を選択します。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/c4ea69a292628bea.png"></p>
<p>IAM コンソールに画面遷移したら、左側のメニューメインから <strong>ロール</strong> をクリックします。<br> ロール画面に遷移したら [<strong>ロールを作成</strong>] ボタンをクリックします。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/894e0ad1017259a6.png"></p>
<p>信頼されたエンティティタイプが <strong>AWS のサービス</strong> が選択されていること、ユースケースは <strong>EC2</strong> が選択されていることを確認して、[<strong>次へ</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/6e25ab2b8ba0d3ff.png"></p>
<p><strong>許可を追加</strong> 画面に推移するので、テキストボックスに <code>AmazonSSMManagedInstanceCore</code> を入力し、表示された <strong>AmazonSSMManagedInstanceCore</strong> のチェックボックスにチェックを入れて、[<strong>次へ</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/c1a4a6165b0831d3.png"></p>
<p><strong>ロール名</strong> には識別しやすい任意のロール名を入力してください。<br> ここでは、<code>handson-ec2-role</code> とします。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/bc7b5a458fff7ca2.png"></p>
<p>最下部まで進み、[<strong>ロールを作成</strong>] ボタンをクリックします。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/c9d370c09e58830d.png"></p>
<p>ロールが作成されたら、本ロールを SSM Agent が利用できるように設定します。<br> テキストボックスにロール名を入力し、ENTER キーを押下します。<br> ロールが表示されたら、リンクをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/5df67c1147cdb46.png"></p>
<p>ロールの詳細画面に遷移したら、[<strong>信頼関係</strong>] タブをクリックし、[<strong>信頼ポリシーを編集</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/a10bfbb8da53fb9c.png"></p>
<p>以下のような形でポリシーが表示されるので、</p>
<pre><code>＜変更前＞
{
    &#34;Version&#34;: &#34;2012-10-17&#34;,
    &#34;Statement&#34;: [
        {
            &#34;Effect&#34;: &#34;Allow&#34;,
            &#34;Principal&#34;: {
                &#34;Service&#34;: &#34;ec2.amazonaws.com&#34;
            },
            &#34;Action&#34;: &#34;sts:AssumeRole&#34;
        }
    ]
}
</code></pre>
<p><code>	"Service": ["ec2.amazonaws.com","ssm.amazonaws.com"]</code> に書き換えてください。</p>
<pre><code>＜変更後＞
{
	&#34;Version&#34;: &#34;2012-10-17&#34;,
	&#34;Statement&#34;: [
		{
			&#34;Effect&#34;: &#34;Allow&#34;,
			&#34;Principal&#34;: {
				&#34;Service&#34;: [&#34;ec2.amazonaws.com&#34;,&#34;ssm.amazonaws.com&#34;]
			},
			&#34;Action&#34;: &#34;sts:AssumeRole&#34;
		}
	]
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ1 - EC2 インスタンスの作成" duration="0">
        <h2 is-upgraded>EC2 コンソールを開く</h2>
<p>左上のサービスボタンをクリックして、コンピューティングから EC2 を選択してください。<br> テキストボックスに入れていただいても候補が表示されます。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/6792d39b7b405b87.png"></p>
<p>EC2 コンソールに画面遷移したら [<strong>インスタンスを起動</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/f01162ae06e9b0b4.png"></p>
<p>[<strong>インスタンスを起動</strong>] のボタンが展開されるのでクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/3b98d2bcebe99726.png"></p>
<h2 is-upgraded>ステップ1: Amazon マシンイメージ(AMI)</h2>
<p>本ハンズオンでは、Amazon Linux 2022 の AMI を利用します。<br> テキストボックスに以下 AMI ID を入力して、ENTER キーをクリックしてください。</p>
<pre><code>AMI 名:
al2022-ami-2022.0.20220315.0-kernel-5.15-x86_64
AMI ID:
ami-082c70eb5ed5441a1
</code></pre>
<p>左側のペインで <strong>コミュニティ AMI (1)</strong> をクリックして、左側の詳細ペインに表示された [<strong>選択</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/b7ee9e5d88e459f2.png"></p>
<h2 is-upgraded>ステップ2: インスタンスタイプの選択</h2>
<p>インスタンスタイプが <strong>t2.micro</strong> であることを確認して、[<strong>次のステップ:インスタンスの詳細の設定</strong>] ボタンをクリックしてください。</p>
<aside class="special"><p> t2.micro は無料利用枠でご利用いただけます。 </p>
</aside>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/2e17b5fb15af1b91.png"></p>
<h2 is-upgraded>ステップ３: インスタンスタイプの詳細の設定</h2>
<p>このページでは、インスタンスの詳細設定を行います。<br> ネットワークで、ご自身で作成された VPC を選択してください。<br> ネットワークにて VPC を選択すると、サブネットの項目が「選択した VPC でフィルタリング」されます。<br> 10.0.0.0/24 に設定したサブネットを選択してください。<br> 自動割り当てパブリック IP は有効にしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/37b44afb12077c73.png"></p>
<aside class="special"><p> どちらのパブリックサブネットが 10.0.0.0/24 か、わからない場合は、新しいタブ (別ウィンドウ) で VPC コンソールを開き、サブネットから Subnet ID を確認してください。 </p>
</aside>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/8ed7671ba7d0aa57.png"></p>
<p>中断にあるロールは、先の手順で作成したロールを選択してください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/66b2f9cc36991203.png"></p>
<p>ページ下部まで進み、ユーザーデータに以下をコピペしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/c927249d459cc048.png"></p>
<p>以下のユーザーデータを流し込んだら、[<strong>次のステップ:ストレージの追加</strong>] ボタンをクリックしてください。</p>
<pre><code>#!/bin/bash
dnf -y update
# SELinux 無効化
setenforce 0
# タイムゾーンを東京に変更
timedatectl set-timezone Asia/Tokyo
localectl set-locale LANG=ja_JP.utf8
# SSM Agent インストール
dnf install -y https://s3.amazonaws.com/ec2-downloads-windows/SSMAgent/latest/linux_amd64/amazon-ssm-agent.rpm
systemctl enable amazon-ssm-agent
systemctl start amazon-ssm-agent
# Nginx インストール
dnf install -y nginx.x86_64

# php インストール
dnf install -y php
dnf install -y php-mbstring php-devel php-gd php-pdo php-xml php-mysqlnd php-json

# PHP FastCGI インストール
dnf install -y php-fpm

#php-fpm 設定変更
sed -i -e &#34;s/user = apache/user = nginx/g&#34; /etc/php-fpm.d/www.conf
sed -i -e &#34;s/group = apache/group = nginx/g&#34; /etc/php-fpm.d/www.conf
systemctl start php-fpm.service

# mariadb インストール
dnf install -y mariadb105-server
sudo systemctl start mariadb
mysql -u root -e &#34;create database wp_database; grant all privileges on wp_database.* to wp_admin@localhost identified by &#39;wordpress&#39;;&#34;

# WordPress インストール
cd /tmp
wget https://ja.wordpress.org/latest-ja.tar.gz
tar -xzf latest-ja.tar.gz
mv wordpress /usr/share/nginx/html
chown -R nginx. /usr/share/nginx/html

# WordPress ディレクトリとフォルダーの権限設定
find /usr/share/nginx/html/wordpress -type d -exec chmod 705 {} +
find /usr/share/nginx/html/wordpress -type f -exec chmod 604 {} +

# WordPress 用の Nginx 設定ファイル
cat &lt;&lt; EOS &gt;&gt; /etc/nginx/conf.d/wordpress.conf
server {
        index index.php index.html;
        root /usr/share/nginx/html/wordpress;

        location ~* /wp-config.php {
                deny all;
        }

        location / {
                try_files \$uri \$uri/ /index.php\$is_args$args;
        }

        location ~ \.php\$ {
                include fastcgi.conf;
                fastcgi_pass   unix:/run/php-fpm/www.sock;
        }
}
EOS

# Nginx スタート
systemctl enable nginx.service
systemctl start nginx.service
</code></pre>
<h2 is-upgraded>ステップ4: ストレージの追加</h2>
<p>選択した AMI は、8GB のストレージを利用します。<br> また、汎用 SSD (gp3) が選択されます。<br> ストレージは、特に変更せずに、次に進みます。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/4e18a35f88d53930.png"></p>
<h2 is-upgraded>ステップ5: タグの追加</h2>
<p>インスタンスを区別できるようにタグに名前を設定します。<br> IAM ユーザを利用している場合、他ユーザと区別が付くように -user1 等ユーザ名を付けると良いでしょう。</p>
<p>ここでは、<code>handson-ec2-wordpress</code> とします。</p>
<p>□ <strong>インスタンス</strong> と<br> □ <strong>ボリューム</strong> と<br> □ <strong>ネットワークインターフェイス</strong></p>
<p>のチェックボックスにチェックを入れると、それぞれのリソースに名前タグが設定されます。<br> [<strong>次のステップ:セキュリティグループの設定</strong>] をクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/5d3e2757f0e22104.png"></p>
<h2 is-upgraded>ステップ6: セキュリティグループの設定</h2>
<p><strong>新しいセキュリティグループを作成する</strong> のオプションボタンにチェックが入っていることを確認してください。<br> セキュリティグループ名と説明は任意の名称を設定してください。本ハンズオンでは、<code>web-sg</code> としました。<br><strong>タイプ</strong> を「SSH」から「HTTP」に変更して、ソースを「<strong>マイ IP</strong>」にしてください。<br> 下部に警告メッセージが表示されますが、セッションマネージャー経由で接続するので問題ありません。<br><strong>ソース</strong> を「任意の場所」にしたら [<strong>確認と作成</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/8f54b7fddf929fae.png"></p>
<h2 is-upgraded>ステップ6: インスタンス作成の確認</h2>
<p>確認画面が表示されます。内容確認して間違えなければ [<strong>起動</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/d72c29ee435f2492.png"></p>
<p>キーペアを指定する画面になります。セッションマネージャーを利用するため、本ハンズオンでは利用しません。<br> [<strong>キーペアなしで続行</strong>] を選択し、チェックボックスにチェックを入れて、[<strong>インスタンスの作成</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/5b7d55458bc6fde9.png"></p>
<p>EC2 インスタンスの作成が始まりました。<br> [<strong>インスタンスの表示</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/13652e520a9ce569.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ1 - セッションマネージャーでアクセスする" duration="0">
        <p>起動したインスタンスは、AMI (Amazon マシンイメージ) から復元されたあと、ユーザーデータに入力したスクリプトによって、インストールが行われていきます。<br> 下図の通り、</p>
<ul>
<li>インスタンスの状態が <strong>実行中</strong> になること</li>
<li>ステータスチェックが 2/2 のチェックに合格しました</li>
</ul>
<p>になることを確認してください。(これには数分かかります。)</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/73912de2afb951c3.png"></p>
<p>また、バックグラウンドでは並行してユーザーデータによるインストールが進行していきます。<br> インストールが完了まで少し時間がかかりますが、このインストールの途中でセッションマネージャーが利用できる状態になります。</p>
<aside class="warning"><p> Amazon Linux 2022 には 2022 年 4 月の段階で、セッションマネージャーを利用するための Systems Manager Agent がプリインストールされていません。 </p>
</aside>
<h2 is-upgraded>ユーザーデータで行う処理</h2>
<ol type="1">
<li><strong>SELinux 無効化<br></strong> Amazon Linux 2022 は Fedora ベースの OS で SELinux が有効になっています。<br> SELinux が有効だと Nginx が正しく動かないため無効化します。</li>
<li><strong>タイムゾーンを東京に変更<br></strong> EC2 インスタンスは大抵 UTC にて稼働します。そのため、起動後にタイムゾーンを Asia/Tokyo にします。</li>
<li><strong>ロケールを日本語に変更</strong></li>
<li><strong>SSM エージェントのインストール<br></strong> SSM エージェントをインストールすると、セッションマネージャーが利用できるようになります。</li>
<li><strong>Nginx インストール<br></strong> Web サーバーとして稼働させるため、Nginx をインストールします。</li>
<li><strong>php インストール<br></strong> WordPress の稼働に必要な PHP と PHP モジュールをインストールします。</li>
<li><strong>MariaDB インストール<br></strong> WordPress で利用する MariaDB をインストールします。</li>
<li><strong>WordPress インストール<br></strong> 最新版の WordPress をダウンロードしてインストールします。</li>
</ol>
<h2 is-upgraded>セッションマネージャーによる接続</h2>
<p>インスタンスが起動したらセッションマネージャーで接続してみましょう。<br> EC2 コンソールの左側のメニューペインにある <strong>インスタンス</strong> をクリックして、右側に表示されるインスタンス一覧から、起動したインスタンスを見つけてください。<br> インスタンスの左側にあるチェックボックスにチェックを入れて、[<strong>接続</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/1bd36727d14fa10f.png"></p>
<p>インスタンスが複数表示されている場合は、テキストボックスにインスタンス名を入れたり、ステータスを <strong>running</strong> でフィルタリングするなどすると効率的に見つけることができます。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/b34e06d3965d7296.png"></p>
<p>[<strong>セッションマネージャー</strong>] タブを選択し、[<strong>接続</strong>] ボタンをクリックします。</p>
<aside class="special"><p> 接続ボタンがアクティブでない場合は、IAM ロールをアタッチし損ねたか、SSM エージェントのインストールがまだ完了していない可能性があります。 </p>
</aside>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/720d7102152fe523.png"></p>
<p>接続が成功すると、ブラウザの新しいタブが開いて以下のようなプロンプトで停止します。</p>
<pre><code>sh-5.1$
</code></pre>
<p>スイッチユーザーして、root ユーザーに昇格してください。</p>
<pre><code>sh-5.1$ sudo -i
#
</code></pre>
<p>本ウインドウは閉じずにそのままにしておいてください。</p>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ1 - ブラウザで　http アクセスする" duration="0">
        <p>次はブラウザから Web ページにアクセスしてみます。<br> EC2 コンソールでインスタンスを選択したら、下部の詳細ペインに表示された <strong>パブリック IPv4 アドレス</strong> を見つけて、アドレスの左側にあるアイコンをクリックしてください。IP アドレスがクリップボードにコピーされます。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/5da8d1b776512961.png"></p>
<p>Chrome タブを追加して、アドレスバーに貼り付けて、ENTER キーを押下しアクセスしてください。WordPress のセットアップ・ウェルカムページが表示されます。</p>
<aside class="warning"><p> ページが表示されない場合は、セキュリティグループの設定に誤りがある可能性があります。 </p>
</aside>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/943301a1761a6903.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ1 - Elastic IP の割り当て" duration="0">
        <h2 is-upgraded>Elastic IP (EIP) を取得</h2>
<p>インスタンスを停止/開始した後も、同じ IP アドレスが使用できるよう、固定 IP アドレスであるElastic IP を取得します。<br> EC2 コンソールにて、左側のメニューペインから <strong>Elastic IP</strong> をクリックし、ページ上部に表示された [<strong>Elastic IP アドレスを割り当てる</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/cfbc1dbc65483dec.png"></p>
<p><strong>Elastic IP アドレスを割り当てる</strong> の画面に遷移するので、Name タグを設定してください。<br> こちらも任意ですが、EC2 インスタンスのタグと揃えると識別しやすいです。</p>
<table>
<tr><td colspan="1" rowspan="1"><p>キー</p>
</td><td colspan="1" rowspan="1"><p>値</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Name</p>
</td><td colspan="1" rowspan="1"><p>handson-ec2-wordpress</p>
</td></tr>
</table>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/27fbd97677ca56ec.png"></p>
<p>Elastic IP アドレスが割り当てられたら、割り当てられた IPv4 アドレスを控えておいてください。<br> メモできたら [<strong>この Elastic IP アドレスを関連づける</strong>] をクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/f5fa9b3883959b7f.png"></p>
<p><strong>インスタンス</strong> に起動した EC2 インスタンスを指定し、プライベート IP アドレスを選択して、[<strong>関連付ける</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/ce18a47aaa9bd2ed.png"></p>
<aside class="warning"><p> 前述の作業で取得した自分の IP アドレスが表示されている事を確認の上、選択してください。 EC2 インスタンスが複数ある場合は誤ったインスタンスにアタッチしないようにご注意ください。 </p>
</aside>
<p>アタッチしたアドレスは、EC2 の詳細画面からも確認できますので再度チェックしておいてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/5da8d1b776512961.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ1 - WordPress の構成" duration="0">
        <h2 is-upgraded>MySQL と Nginx が動いていることを確認</h2>
<p>先ほど接続したセッションマネージャーのブラウザタブに戻り、MySQL と Nginx が動いていることを確認したいと思います。<br> 以下の root 権限にて、</p>
<pre><code>sh-5.1$ sudo -i
#
</code></pre>
<p>以下コマンドを入力してください。</p>
<p><code>systemctl status mariadb</code></p>
<p>以下のような <code>running</code> ステータスが返れば正常に起動しています。<br> [Q] キーを押下すると、抜けることができます。</p>
<pre><code># systemctl status mariadb
● mariadb.service - MariaDB 10.5 database server
     Loaded: loaded (/usr/lib/systemd/system/mariadb.service; disabled; vendor preset: disabled)
     Active: active (running) since Wed 2022-04-06 21:16:03 JST; 1h 48min ago
       Docs: man:mariadbd(8)
             https://mariadb.com/kb/en/library/systemd/
   Main PID: 29016 (mariadbd)
     Status: &#34;Taking your SQL requests now...&#34;
      Tasks: 8 (limit: 1096)
     Memory: 64.7M
        CPU: 1.324s
     CGroup: /system.slice/mariadb.service
             └─29016 /usr/libexec/mariadbd --basedir=/usr

 4月 06 21:16:03 ip-10-0-0-44.ap-northeast-1.compute.internal mariadb-prepare-db-dir[28974]: See the MariaDB Knowledgebase at&gt;

 (中略)

 4月 06 21:16:03 ip-10-0-0-44.ap-northeast-1.compute.internal systemd[1]: Started MariaDB 10.5 database server.
lines 1-23/23 (END)
</code></pre>
<p>続いて、Nginx サーバーを確認します。<br> 以下コマンドを入力してください。</p>
<p><code>systemctl status nginx</code></p>
<p>以下のような <code>running</code> ステータスが返れば正常に起動しています。<br> [Q] キーを押下すると、抜けることができます。</p>
<pre><code># systemctl status nginx
● nginx.service - The nginx HTTP and reverse proxy server
     Loaded: loaded (/usr/lib/systemd/system/nginx.service; enabled; vendor preset: disabled)
    Drop-In: /usr/lib/systemd/system/nginx.service.d
             └─php-fpm.conf
     Active: active (running) since Wed 2022-04-06 21:16:16 JST; 1h 47min ago
    Process: 29098 ExecStartPre=/usr/bin/rm -f /run/nginx.pid (code=exited, status=0/SUCCESS)
    Process: 29099 ExecStartPre=/usr/sbin/nginx -t (code=exited, status=0/SUCCESS)
    Process: 29100 ExecStart=/usr/sbin/nginx (code=exited, status=0/SUCCESS)
   Main PID: 29101 (nginx)
      Tasks: 3 (limit: 1096)
     Memory: 5.9M
        CPU: 61ms
     CGroup: /system.slice/nginx.service
             ├─29101 nginx: master process /usr/sbin/nginx
             ├─29102 nginx: worker process
             └─29103 nginx: worker process

 4月 06 21:16:16 ip-10-0-0-44.ap-northeast-1.compute.internal systemd[1]: Starting The nginx HTTP and reverse proxy server...
 
 (中略)
 
 4月 06 21:16:16 ip-10-0-0-44.ap-northeast-1.compute.internal systemd[1]: Started The nginx HTTP and reverse proxy server.
lines 1-21/21 (END)
</code></pre>
<h2 is-upgraded>セッションマネージャーによる接続がうまくいかない場合</h2>
<ul>
<li>インスタンスは完全に起動完了していますでしょうか。ステータスチェックは 2/2 になっていますか？</li>
<li>起動時に指定した内容どおりに起動しているでしょうか?</li>
<li>接続先のインスタンス ID は正しいですか？</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="フェーズ1 - WordPress の初期設定" duration="0">
        <p>http://&lt;Elastic IPアドレス&gt;/wordpress/ を開いて、WordPressの初期設定を始めます。<br> 上記 URL にアクセスすると、自動で setup-config.php にリダイレクトします。</p>
<p>[さあ、始めましょう!] ボタンをクリックします。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/7ad69039a6b76952.png"></p>
<h2 is-upgraded>作成した MySQL の DB 設定に基づき、設定します。</h2>
<table>
<tr><td colspan="1" rowspan="1"><p>項目</p>
</td><td colspan="1" rowspan="1"><p>値</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>データベース名</strong></p>
</td><td colspan="1" rowspan="1"><p>wp_database</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>ユーザー名</strong></p>
</td><td colspan="1" rowspan="1"><p>wp_admin</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>パスワード</strong></p>
</td><td colspan="1" rowspan="1"><p>wordpress</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>データベースのホスト名</strong></p>
</td><td colspan="1" rowspan="1"><p>localhost</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>テーブル接頭辞</strong></p>
</td><td colspan="1" rowspan="1"><p>wp_</p>
</td></tr>
</table>
<p>以下の画面が表示されるので、上記の値を入力して、[<strong>送信</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/83194f3776a544e1.png"></p>
<p>以下画面に遷移するので、[<strong>インストール実行</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/592c12573ebca0a4.png"></p>
<p>以下画面に遷移するので、画像の通り入力してください。<br> [<strong>WordPress をインストール</strong>] ボタンをクリックしたあと、20 秒程度かかります。<br> ブラウザのローディングが終わるまで、リロードなど行わずに少々お待ちください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/3acdc45d40ef1337.png"></p>
<p>以下の画面が表示されたらセットアップ完了です。<br> [<strong>ログイン</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/6862e74858626cb4.png"></p>
<h2 is-upgraded>WordPress ログイン画面</h2>
<p>以下、ログイン画面が表示されるので先ほど入力したユーザー名とパスワードを入力してください。<br> [<strong>ログイン</strong>] ボタンをクリックしてください。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/1373a94d6c1078f3.png"></p>
<h2 is-upgraded>WordPress 管理者画面</h2>
<p>ユーザー名とパスワードが正しく入力され、認証が通れば WordPress の管理者画面が表示されます。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/59f33d2f7d793db5.png"></p>
<ol type="1">
<li>[<strong>投稿</strong>] をクリックして、任意の新規ブログポストを書くことができます。<br><img alt="AWS マネジメントコンソール サインイン画面" src="img/44f40a96071d1cdc.png"></li>
<li>ブログタイトルをクリックするとブログが表示できます。<br><img alt="AWS マネジメントコンソール サインイン画面" src="img/97d0ac91af2d5c06.png"></li>
</ol>
<h2 is-upgraded>ブログの起動確認</h2>
<p>Wordpress ブログが実行できていることを確認します。<br> (nginxの画面が出る場合はリロードしてみてください)<br> 前ページの管理画面に戻るには http://EIPアドレス/wp-admin/ にアクセスします。</p>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/6070997e65add016.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="座学 - Amazon Aurora RDS" duration="0">
        <h2 is-upgraded>Amazon Aurora</h2>
<p class="image-container"><img alt="AWS マネジメントコンソール サインイン画面" src="img/834f3a8671e444f1.png"></p>
<p>Amazon Aurora は、標準的な MySQL データベースと比べて最大で 5 倍、標準的な PostgreSQL データベースと比べて最大で 3 倍高速です。また、商用データベースと同等のセキュリティ、可用性、信頼性を、10 分の 1 のコストで実現します。</p>
<h2 is-upgraded>Amazon RDS</h2>
<p>Amazon Relational Database Service (RDS) は、AWS にて運用管理されるマネージドRDBMS サービスです。　　 MySQL、Oracle、SQL Server、PostgreSQL、MariaDB、Aurora が提供されています。<br> バックアップやフェイルオーバーに対応した DB を数クリックで利用可能にします。<br> メンテナンスフリーで、自動バックアップや、パッチ当てなどが自動で行われます。</p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
